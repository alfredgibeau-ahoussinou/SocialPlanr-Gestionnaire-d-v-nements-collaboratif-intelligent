"use client"; import { useEffect, useState } from "react"; import ProtectedRoute from "@/components/ProtectedRoute"; import Navigation from "@/components/Navigation"; import Footer from "@/components/Footer"; import { useAuth } from "@/contexts/AuthContext"; import { collection, query, where, onSnapshot, addDoc, deleteDoc, doc } from "firebase/firestore"; import { db } from "@/config/firebase"; import { Account } from "@/types"; export default function AccountsPage() { const { user } = useAuth(); const [accounts, setAccounts] = useState<Account[]>([]); const [loading, setLoading] = useState(true); const [showModal, setShowModal] = useState(false); const [formData, setFormData] = useState({ name: "", description: "", type: "personal" as "personal" | "business", currency: "EUR" as "EUR" | "USD" | "XOF" | "GBP", }); useEffect(() => { if (!user) return; const accountsQuery = query( collection(db, "accounts"), where("createdBy", "==", user.uid) ); const unsubscribe = onSnapshot(accountsQuery, (snapshot) => { const accountsData = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate() || new Date(), updatedAt: doc.data().updatedAt?.toDate() || new Date(), })) as Account[]; setAccounts(accountsData); setLoading(false); }); return unsubscribe; }, [user]); const handleCreateAccount = async (e: React.FormEvent) => { e.preventDefault(); if (!user) return; try { await addDoc(collection(db, "accounts"), { ...formData, balance: 0, createdBy: user.uid, status: "active", createdAt: new Date(), updatedAt: new Date(), }); setShowModal(false); setFormData({ name: "", description: "", type: "personal", currency: "EUR", }); } catch (error) { console.error("Erreur lors de la création du compte:", error); } }; const handleDelete = async (accountId: string) => { if (!confirm("Êtes-vous sûr de vouloir supprimer ce compte ?")) return; try { await deleteDoc(doc(db, "accounts", accountId)); } catch (error) { console.error("Erreur lors de la suppression:", error); } }; const totalBalance = accounts.reduce((sum, acc) => sum + acc.balance, 0); const personalAccounts = accounts.filter((acc) => acc.type === "personal"); const businessAccounts = accounts.filter((acc) => acc.type === "business"); return ( <ProtectedRoute> <div className="min-h-screen bg-gradient-to-br from-stone-50 via-amber-50 to-amber-50"> <Navigation /> <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"> <div className="flex items-center justify-between mb-8"> <div> <h1 className="text-3xl font-bold text-gray-900 mb-2">Mes comptes</h1> <p className="text-gray-600">Gérez vos comptes personnels et professionnels</p> </div> <button onClick={() => setShowModal(true)} className="bg-gradient-to-r from-amber-700 to-stone-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all" > + Créer un compte </button> </div> {loading ? ( <div className="text-center py-12"> <div className="w-16 h-16 border-4 border-amber-700 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> <p className="text-gray-600">Chargement...</p> </div> ) : ( <> {/* Solde total */} <div className="bg-white rounded-xl shadow-lg p-6 mb-8"> <h2 className="text-sm font-medium text-gray-600 mb-2">Solde total</h2> <p className={`text-4xl font-bold ${totalBalance >= 0 ? "text-green-600" : "text-red-600"}`}> {totalBalance >= 0 ? "+" : ""} {totalBalance.toFixed(2)} € </p> </div> {/* Comptes personnels */} {personalAccounts.length > 0 && ( <div className="mb-8"> <h2 className="text-xl font-bold text-gray-900 mb-4"> Comptes personnels ({personalAccounts.length}) </h2> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> {personalAccounts.map((account) => ( <div key={account.id} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow" > <div className="flex items-center justify-between mb-4"> <h3 className="text-lg font-semibold text-gray-900">{account.name}</h3> <button onClick={() => handleDelete(account.id)} className="text-red-600 hover:text-red-700" > </button> </div> {account.description && ( <p className="text-sm text-gray-600 mb-4">{account.description}</p> )} <p className={`text-2xl font-bold mb-2 ${account.balance >= 0 ? "text-green-600" : "text-red-600"}`}> {account.balance >= 0 ? "+" : ""} {account.balance.toFixed(2)} {account.currency} </p> <span className="inline-block bg-stone-100 text-amber-800 text-xs px-2 py-1 rounded"> {account.type} </span> </div> ))} </div> </div> )} {/* Comptes professionnels */} {businessAccounts.length > 0 && ( <div className="mb-8"> <h2 className="text-xl font-bold text-gray-900 mb-4"> Comptes professionnels ({businessAccounts.length}) </h2> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> {businessAccounts.map((account) => ( <div key={account.id} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow" > <div className="flex items-center justify-between mb-4"> <h3 className="text-lg font-semibold text-gray-900">{account.name}</h3> <button onClick={() => handleDelete(account.id)} className="text-red-600 hover:text-red-700" > </button> </div> {account.description && ( <p className="text-sm text-gray-600 mb-4">{account.description}</p> )} <p className={`text-2xl font-bold mb-2 ${account.balance >= 0 ? "text-green-600" : "text-red-600"}`}> {account.balance >= 0 ? "+" : ""} {account.balance.toFixed(2)} {account.currency} </p> <span className="inline-block bg-stone-100 text-purple-800 text-xs px-2 py-1 rounded"> {account.type} </span> </div> ))} </div> </div> )} {accounts.length === 0 && ( <div className="bg-white rounded-xl shadow-lg p-12 text-center"> <p className="text-gray-500 mb-4">Aucun compte créé</p> <button onClick={() => setShowModal(true)} className="bg-amber-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-amber-800 transition-colors" > Créer votre premier compte </button> </div> )} </> )} {/* Modal de création */} {showModal && ( <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"> <div className="bg-white rounded-xl shadow-xl max-w-md w-full p-6"> <h2 className="text-2xl font-bold text-gray-900 mb-4">Créer un compte</h2> <form onSubmit={handleCreateAccount} className="space-y-4"> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Nom du compte </label> <input type="text" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-600" placeholder="Compte courant" /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2"> Description (optionnel) </label> <input type="text" value={formData.description} onChange={(e) => setFormData({ ...formData, description: e.target.value })} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-600" /> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2">Type</label> <select value={formData.type} onChange={(e) => setFormData({ ...formData, type: e.target.value as "personal" | "business" })} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-600" > <option value="personal">Personnel</option> <option value="business">Professionnel</option> </select> </div> <div> <label className="block text-sm font-medium text-gray-700 mb-2">Devise</label> <select value={formData.currency} onChange={(e) => setFormData({ ...formData, currency: e.target.value as "EUR" | "USD" | "XOF" | "GBP" })} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-600" > <option value="EUR">EUR (€)</option> <option value="USD">USD ($)</option> <option value="XOF">XOF (CFA)</option> <option value="GBP">GBP (£)</option> </select> </div> <div className="flex space-x-4"> <button type="button" onClick={() => setShowModal(false)} className="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50" > Annuler </button> <button type="submit" className="flex-1 px-4 py-2 bg-amber-700 text-white rounded-lg hover:bg-amber-800" > Créer </button> </div> </form> </div> </div> )} </main> <Footer /> </div> </ProtectedRoute> ); } 