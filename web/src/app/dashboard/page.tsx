"use client"; import { useEffect, useState } from "react"; import ProtectedRoute from "@/components/ProtectedRoute"; import Navigation from "@/components/Navigation"; import Footer from "@/components/Footer"; import { useAuth } from "@/contexts/AuthContext"; import { collection, query, where, onSnapshot } from "firebase/firestore"; import { db } from "@/config/firebase"; import { Account, Transaction, Budget } from "@/types"; import Link from "next/link"; export default function DashboardPage() { const { user } = useAuth(); const [accounts, setAccounts] = useState<Account[]>([]); const [transactions, setTransactions] = useState<Transaction[]>([]); const [budgets, setBudgets] = useState<Budget[]>([]); const [loading, setLoading] = useState(true); useEffect(() => { if (!user) return; // Ã‰couter les comptes const accountsQuery = query( collection(db, "accounts"), where("createdBy", "==", user.uid) ); const unsubscribeAccounts = onSnapshot(accountsQuery, (snapshot) => { const accountsData = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data(), createdAt: doc.data().createdAt?.toDate() || new Date(), updatedAt: doc.data().updatedAt?.toDate() || new Date(), })) as Account[]; setAccounts(accountsData); }); // Ã‰couter les transactions rÃ©centes const transactionsQuery = query( collection(db, "transactions"), where("createdBy", "==", user.uid) ); const unsubscribeTransactions = onSnapshot(transactionsQuery, (snapshot) => { const transactionsData = snapshot.docs .map((doc) => ({ id: doc.id, ...doc.data(), date: doc.data().date?.toDate() || new Date(), createdAt: doc.data().createdAt?.toDate() || new Date(), updatedAt: doc.data().updatedAt?.toDate() || new Date(), })) .sort((a, b) => b.date.getTime() - a.date.getTime()) .slice(0, 5) as Transaction[]; setTransactions(transactionsData); }); // Ã‰couter les budgets const budgetsQuery = query( collection(db, "budgets"), where("createdBy", "==", user.uid) ); const unsubscribeBudgets = onSnapshot(budgetsQuery, (snapshot) => { const budgetsData = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data(), startDate: doc.data().startDate?.toDate() || new Date(), endDate: doc.data().endDate?.toDate(), createdAt: doc.data().createdAt?.toDate() || new Date(), updatedAt: doc.data().updatedAt?.toDate() || new Date(), })) as Budget[]; setBudgets(budgetsData); setLoading(false); }); return () => { unsubscribeAccounts(); unsubscribeTransactions(); unsubscribeBudgets(); }; }, [user]); const totalBalance = accounts.reduce((sum, acc) => sum + acc.balance, 0); const totalIncome = transactions .filter((t) => t.type === "income") .reduce((sum, t) => sum + t.amount, 0); const totalExpenses = transactions .filter((t) => t.type === "expense") .reduce((sum, t) => sum + t.amount, 0); return ( <ProtectedRoute> <div className="min-h-screen bg-gradient-to-br from-stone-50 via-amber-50 to-amber-50"> <Navigation /> <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"> <div className="mb-8"> <h1 className="text-3xl font-bold text-gray-900 mb-2">Dashboard</h1> <p className="text-gray-600">Vue d&apos;ensemble de vos finances</p> </div> {loading ? ( <div className="text-center py-12"> <div className="w-16 h-16 border-4 border-amber-700 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div> <p className="text-gray-600">Chargement des donnÃ©es...</p> </div> ) : ( <> {/* Statistiques principales */} <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"> <div className="bg-white rounded-xl shadow-lg p-6"> <div className="flex items-center justify-between mb-4"> <h3 className="text-sm font-medium text-gray-600">Solde total</h3> <span className="text-2xl"></span> </div> <p className={`text-3xl font-bold ${totalBalance >= 0 ? "text-green-600" : "text-red-600"}`}> {totalBalance >= 0 ? "+" : ""} {totalBalance.toFixed(2)} â‚¬ </p> </div> <div className="bg-white rounded-xl shadow-lg p-6"> <div className="flex items-center justify-between mb-4"> <h3 className="text-sm font-medium text-gray-600">Revenus</h3> <span className="text-2xl"></span> </div> <p className="text-3xl font-bold text-green-600"> +{totalIncome.toFixed(2)} â‚¬ </p> </div> <div className="bg-white rounded-xl shadow-lg p-6"> <div className="flex items-center justify-between mb-4"> <h3 className="text-sm font-medium text-gray-600">DÃ©penses</h3> <span className="text-2xl">ðŸ“‰</span> </div> <p className="text-3xl font-bold text-red-600"> -{totalExpenses.toFixed(2)} â‚¬ </p> </div> </div> {/* Comptes */} <div className="bg-white rounded-xl shadow-lg p-6 mb-8"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-gray-900">Mes comptes</h2> <Link href="/accounts" className="text-amber-700 hover:text-amber-800 font-medium text-sm" > Voir tout â†’ </Link> </div> {accounts.length === 0 ? ( <div className="text-center py-8"> <p className="text-gray-500 mb-4">Aucun compte crÃ©Ã©</p> <Link href="/accounts" className="inline-block bg-amber-700 text-white px-6 py-2 rounded-lg hover:bg-amber-800 transition-colors" > CrÃ©er un compte </Link> </div> ) : ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {accounts.slice(0, 3).map((account) => ( <div key={account.id} className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow" > <div className="flex items-center justify-between mb-2"> <h3 className="font-semibold text-gray-900">{account.name}</h3> <span className="text-xs bg-stone-100 text-amber-800 px-2 py-1 rounded"> {account.type} </span> </div> <p className={`text-2xl font-bold ${account.balance >= 0 ? "text-green-600" : "text-red-600"}`}> {account.balance >= 0 ? "+" : ""} {account.balance.toFixed(2)} {account.currency} </p> </div> ))} </div> )} </div> {/* Transactions rÃ©centes */} <div className="bg-white rounded-xl shadow-lg p-6 mb-8"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-gray-900">Transactions rÃ©centes</h2> <Link href="/transactions" className="text-amber-700 hover:text-amber-800 font-medium text-sm" > Voir tout â†’ </Link> </div> {transactions.length === 0 ? ( <div className="text-center py-8"> <p className="text-gray-500 mb-4">Aucune transaction</p> <Link href="/transactions" className="inline-block bg-amber-700 text-white px-6 py-2 rounded-lg hover:bg-amber-800 transition-colors" > Ajouter une transaction </Link> </div> ) : ( <div className="space-y-3"> {transactions.map((transaction) => ( <div key={transaction.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" > <div className="flex items-center space-x-4"> <div className={`w-12 h-12 rounded-full flex items-center justify-center ${ transaction.type === "income" ? "bg-green-100" : "bg-red-100" }`} > <span className="text-xl"> {transaction.type === "income" ? "" : "ðŸ“‰"} </span> </div> <div> <p className="font-semibold text-gray-900"> {transaction.description || transaction.category} </p> <p className="text-sm text-gray-500"> {transaction.date.toLocaleDateString("fr-FR")} </p> </div> </div> <p className={`text-lg font-bold ${ transaction.type === "income" ? "text-green-600" : "text-red-600" }`} > {transaction.type === "income" ? "+" : "-"} {transaction.amount.toFixed(2)} â‚¬ </p> </div> ))} </div> )} </div> {/* Budgets */} <div className="bg-white rounded-xl shadow-lg p-6"> <div className="flex items-center justify-between mb-4"> <h2 className="text-xl font-bold text-gray-900">Mes budgets</h2> <Link href="/budgets" className="text-amber-700 hover:text-amber-800 font-medium text-sm" > Voir tout â†’ </Link> </div> {budgets.length === 0 ? ( <div className="text-center py-8"> <p className="text-gray-500 mb-4">Aucun budget crÃ©Ã©</p> <Link href="/budgets" className="inline-block bg-amber-700 text-white px-6 py-2 rounded-lg hover:bg-amber-800 transition-colors" > CrÃ©er un budget </Link> </div> ) : ( <div className="space-y-4"> {budgets.slice(0, 3).map((budget) => { const percentage = (budget.spent / budget.limit) * 100; return ( <div key={budget.id} className="border border-gray-200 rounded-lg p-4"> <div className="flex items-center justify-between mb-2"> <h3 className="font-semibold text-gray-900">{budget.name}</h3> <span className="text-sm text-gray-600"> {budget.spent.toFixed(2)} / {budget.limit.toFixed(2)} â‚¬ </span> </div> <div className="w-full bg-gray-200 rounded-full h-2 mb-2"> <div className={`h-2 rounded-full ${ percentage > 100 ? "bg-red-600" : percentage > 80 ? "bg-yellow-600" : "bg-green-600" }`} style={{ width: `${Math.min(percentage, 100)}%` }} ></div> </div> <p className="text-xs text-gray-500"> {percentage.toFixed(1)}% utilisÃ© </p> </div> ); })} </div> )} </div> </> )} </main> <Footer /> </div> </ProtectedRoute> ); } 