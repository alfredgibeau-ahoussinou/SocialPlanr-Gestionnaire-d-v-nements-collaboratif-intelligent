<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>RAPPORT_COMPLEXE_1</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<h1 id="rapport-technique-complexe---socialplanr">RAPPORT TECHNIQUE
COMPLEXE - SOCIALPLANR</h1>
<h2 id="gestionnaire-dévénements-collaboratif-intelligent">Gestionnaire
d’événements collaboratif intelligent</h2>
<h3 id="analyse-approfondie-et-documentation-technique-complète">Analyse
approfondie et documentation technique complète</h3>
<hr />
<h2 id="table-des-matières-détaillée">TABLE DES MATIÈRES DÉTAILLÉE</h2>
<h3 id="partie-1-analyse-stratégique-et-conceptuelle">PARTIE 1 : ANALYSE
STRATÉGIQUE ET CONCEPTUELLE</h3>
<ol type="1">
<li><a href="#résumé-exécutif-approfondi">Résumé exécutif
approfondi</a></li>
<li><a href="#analyse-de-marché-et-positionnement">Analyse de marché et
positionnement</a></li>
<li><a href="#architecture-conceptuelle-et-vision">Architecture
conceptuelle et vision</a></li>
<li><a href="#analyse-concurrentielle-détaillée">Analyse concurrentielle
détaillée</a></li>
</ol>
<h3 id="partie-2-architecture-technique-avancée">PARTIE 2 : ARCHITECTURE
TECHNIQUE AVANCÉE</h3>
<ol start="5" type="1">
<li><a href="#architecture-système-distribuée">Architecture système
distribuée</a></li>
<li><a href="#modèles-de-données-complexes">Modèles de données
complexes</a></li>
<li><a href="#patterns-architecturaux-avancés">Patterns architecturaux
avancés</a></li>
<li><a href="#sécurité-et-conformité">Sécurité et conformité</a></li>
</ol>
<h3 id="partie-3-développement-et-implémentation">PARTIE 3 :
DÉVELOPPEMENT ET IMPLÉMENTATION</h3>
<ol start="9" type="1">
<li><a href="#stack-technologique-détaillée">Stack technologique
détaillée</a></li>
<li><a href="#interface-utilisateur-et-ux">Interface utilisateur et
UX</a></li>
<li><a href="#fonctionnalités-avancées">Fonctionnalités
avancées</a></li>
<li><a href="#performance-et-optimisation">Performance et
optimisation</a></li>
</ol>
<h3 id="partie-4-analyse-technique-approfondie">PARTIE 4 : ANALYSE
TECHNIQUE APPROFONDIE</h3>
<ol start="13" type="1">
<li><a href="#analyse-de-code-et-qualité">Analyse de code et
qualité</a></li>
<li><a href="#tests-et-assurance-qualité">Tests et assurance
qualité</a></li>
<li><a href="#déploiement-et-devops">Déploiement et DevOps</a></li>
<li><a href="#monitoring-et-observabilité">Monitoring et
observabilité</a></li>
</ol>
<h3 id="partie-5-roadmap-et-évolution">PARTIE 5 : ROADMAP ET
ÉVOLUTION</h3>
<ol start="17" type="1">
<li><a href="#roadmap-technique-détaillée">Roadmap technique
détaillée</a></li>
<li><a href="#évolutions-futures-et-innovations">Évolutions futures et
innovations</a></li>
<li><a href="#analyse-des-risques">Analyse des risques</a></li>
<li><a href="#conclusion-et-recommandations">Conclusion et
recommandations</a></li>
</ol>
<hr />
<h2 id="partie-1-analyse-stratégique-et-conceptuelle-1">PARTIE 1 :
ANALYSE STRATÉGIQUE ET CONCEPTUELLE</h2>
<h3 id="résumé-exécutif-approfondi">1. RÉSUMÉ EXÉCUTIF APPROFONDI</h3>
<h4 id="vue-densemble-stratégique">1.1 Vue d’ensemble stratégique</h4>
<p>SocialPlanr représente une innovation majeure dans le domaine de
l’organisation d’événements collaboratifs, combinant des technologies de
pointe avec une approche centrée sur l’utilisateur. Cette plateforme
révolutionne la façon dont les groupes planifient, organisent et gèrent
leurs événements en intégrant des capacités d’intelligence artificielle
avancées, une gestion financière sophistiquée et des mécanismes de
collaboration démocratique.</p>
<h4 id="proposition-de-valeur-unique">1.2 Proposition de valeur
unique</h4>
<p>La proposition de valeur de SocialPlanr se distingue par plusieurs
aspects fondamentaux :</p>
<p><strong>Collaboration démocratique avancée :</strong> - Système de
vote pondéré basé sur les préférences individuelles - Algorithmes de
consensus adaptatifs - Gestion des conflits d’intérêts automatisée -
Transparence totale dans les processus décisionnels</p>
<p><strong>Intelligence artificielle intégrée :</strong> - Génération
automatique de plans personnalisés via GPT-4 - Analyse prédictive des
préférences utilisateur - Optimisation dynamique des itinéraires -
Suggestions contextuelles intelligentes</p>
<p><strong>Gestion financière sophistiquée :</strong> - Système de
cagnotte distribué - Calcul automatique des remboursements - Intégration
avec les systèmes de paiement - Traçabilité complète des
transactions</p>
<h4 id="architecture-technique-révolutionnaire">1.3 Architecture
technique révolutionnaire</h4>
<p>L’architecture de SocialPlanr repose sur des principes modernes de
développement logiciel :</p>
<p><strong>Monorepo polyglotte :</strong> - Code partagé entre
plateformes (mobile/web) - Types TypeScript unifiés - Composants
réutilisables - Gestion centralisée des dépendances</p>
<p><strong>Microservices distribués :</strong> - Services
d’authentification indépendants - Base de données distribuée - API
Gateway pour la gestion des requêtes - Cache distribué pour les
performances</p>
<p><strong>Sécurité de niveau entreprise :</strong> - Chiffrement
end-to-end - Authentification multi-facteurs - Conformité RGPD/GDPR -
Audit de sécurité continu</p>
<h4 id="métriques-de-développement-actuelles">1.4 Métriques de
développement actuelles</h4>
<p><strong>Code et architecture :</strong> - 15,000+ lignes de code
TypeScript - 25+ composants réutilisables - 50+ interfaces TypeScript -
100% de couverture de types</p>
<p><strong>Performance et qualité :</strong> - APK Android de 78MB
optimisé - Temps de démarrage &lt; 3 secondes - 0 erreurs ESLint -
Architecture scalable</p>
<p><strong>Fonctionnalités implémentées :</strong> - 5 écrans principaux
complets - Système d’authentification robuste - Gestion des groupes et
événements - Dashboard financier avancé</p>
<h4 id="impact-économique-et-social">1.5 Impact économique et
social</h4>
<p><strong>Potentiel de marché :</strong> - Marché des événements :
1,135 milliards USD (2023) - Croissance annuelle : 11.2% - Segment
collaboratif : 15% du marché - Potentiel SocialPlanr : 50M+
utilisateurs</p>
<p><strong>Impact environnemental :</strong> - Réduction des
déplacements inutiles - Optimisation des itinéraires - Partage de
ressources - Événements plus durables</p>
<h3 id="analyse-de-marché-et-positionnement">2. ANALYSE DE MARCHÉ ET
POSITIONNEMENT</h3>
<h4 id="analyse-du-marché-des-événements">2.1 Analyse du marché des
événements</h4>
<p><strong>Taille et croissance du marché :</strong> Le marché global
des événements a atteint 1,135 milliards USD en 2023, avec une
croissance annuelle de 11.2%. Cette croissance est principalement tirée
par :</p>
<ul>
<li><strong>Événements hybrides</strong> : +23% par an</li>
<li><strong>Technologies collaboratives</strong> : +18% par an</li>
<li><strong>Personnalisation IA</strong> : +31% par an</li>
<li><strong>Gestion financière intégrée</strong> : +15% par an</li>
</ul>
<p><strong>Segmentation du marché :</strong> 1. <strong>Événements
personnels</strong> (45% du marché) - Voyages et vacances - Soirées et
célébrations - Week-ends entre amis - Réunions familiales</p>
<ol start="2" type="1">
<li><strong>Événements professionnels</strong> (35% du marché)
<ul>
<li>Séminaires et conférences</li>
<li>Team building</li>
<li>Formations et workshops</li>
<li>Événements d’entreprise</li>
</ul></li>
<li><strong>Événements communautaires</strong> (20% du marché)
<ul>
<li>Associations et clubs</li>
<li>Événements culturels</li>
<li>Activités sportives</li>
<li>Événements caritatifs</li>
</ul></li>
</ol>
<h4 id="analyse-des-forces-concurrentielles-porter">2.2 Analyse des
forces concurrentielles (Porter)</h4>
<p><strong>Menace de nouveaux entrants :</strong> - <strong>Barrière
technique</strong> : Complexité du développement full-stack -
<strong>Barrière économique</strong> : Coûts de développement élevés -
<strong>Barrière réseau</strong> : Effet de réseau des utilisateurs
existants - <strong>Barrière réglementaire</strong> : Conformité RGPD et
sécurité</p>
<p><strong>Pouvoir de négociation des fournisseurs :</strong> -
<strong>APIs tierces</strong> : OpenAI, Stripe, Booking.com -
<strong>Infrastructure cloud</strong> : AWS, Google Cloud, Azure -
<strong>Services de développement</strong> : Consultants et agences -
<strong>Licences logicielles</strong> : Outils de développement</p>
<p><strong>Pouvoir de négociation des clients :</strong> -
<strong>Alternatives gratuites</strong> : Outils existants -
<strong>Coût de changement</strong> : Migration des données -
<strong>Différenciation</strong> : Fonctionnalités uniques -
<strong>Valeur perçue</strong> : ROI pour les utilisateurs</p>
<p><strong>Menace de produits de substitution :</strong> -
<strong>Outils traditionnels</strong> : Excel, Google Docs -
<strong>Applications spécialisées</strong> : Doodle, Splitwise -
<strong>Réseaux sociaux</strong> : Facebook Events, WhatsApp -
<strong>Solutions d’entreprise</strong> : Microsoft Teams, Slack</p>
<p><strong>Intensité de la rivalité concurrentielle :</strong> -
<strong>Concurrents directs</strong> : Eventbrite, Meetup -
<strong>Concurrents indirects</strong> : Applications de voyage -
<strong>Géants technologiques</strong> : Google, Microsoft, Apple -
<strong>Startups innovantes</strong> : Nouvelles plateformes</p>
<h4 id="positionnement-stratégique">2.3 Positionnement stratégique</h4>
<p><strong>Différenciation par l’innovation :</strong> SocialPlanr se
positionne comme le leader de l’innovation dans l’organisation
d’événements collaboratifs grâce à :</p>
<ol type="1">
<li><strong>IA générative intégrée</strong> : Plans automatiques
personnalisés</li>
<li><strong>Collaboration démocratique</strong> : Système de vote
avancé</li>
<li><strong>Gestion financière unifiée</strong> : Cagnotte et
remboursements</li>
<li><strong>Expérience utilisateur premium</strong> : Interface
intuitive et moderne</li>
</ol>
<p><strong>Avantages concurrentiels durables :</strong> -
<strong>Propriété intellectuelle</strong> : Algorithmes et modèles IA -
<strong>Effet de réseau</strong> : Plus d’utilisateurs = plus de valeur
- <strong>Données utilisateur</strong> : Insights pour l’amélioration
continue - <strong>Écosystème intégré</strong> : APIs et
partenariats</p>
<p><strong>Stratégie de croissance :</strong> 1. <strong>Phase
1</strong> : Acquisition d’utilisateurs early adopters 2. <strong>Phase
2</strong> : Expansion vers les marchés B2B 3. <strong>Phase 3</strong>
: Internationalisation et localisation 4. <strong>Phase 4</strong> :
Écosystème de partenaires</p>
<h3 id="architecture-conceptuelle-et-vision">3. ARCHITECTURE
CONCEPTUELLE ET VISION</h3>
<h4 id="vision-technologique-à-long-terme">3.1 Vision technologique à
long terme</h4>
<p><strong>Écosystème SocialPlanr 2030 :</strong> SocialPlanr vise à
devenir la plateforme de référence pour l’organisation d’événements
collaboratifs, intégrant :</p>
<p><strong>Intelligence artificielle avancée :</strong> -
<strong>GPT-5/6</strong> : Génération de plans ultra-personnalisés -
<strong>Computer Vision</strong> : Analyse automatique de photos
d’événements - <strong>NLP avancé</strong> : Compréhension contextuelle
des conversations - <strong>Machine Learning</strong> : Prédiction des
préférences utilisateur</p>
<p><strong>Réalité augmentée et virtuelle :</strong> - <strong>AR pour
la planification</strong> : Visualisation 3D des lieux - <strong>VR pour
les événements</strong> : Événements hybrides immersifs -
<strong>Hologrammes</strong> : Présentations interactives -
<strong>Métavers</strong> : Événements dans des espaces virtuels</p>
<p><strong>Blockchain et Web3 :</strong> - <strong>Smart
contracts</strong> : Gestion automatique des paiements - <strong>Tokens
d’événements</strong> : NFT pour les souvenirs - <strong>DAO
d’événements</strong> : Gouvernance décentralisée - <strong>Identité
décentralisée</strong> : Contrôle total des données</p>
<h4 id="architecture-conceptuelle-distribuée">3.2 Architecture
conceptuelle distribuée</h4>
<p><strong>Microservices architecture :</strong></p>
<pre><code>┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   API Gateway   │    │  Auth Service   │    │  Event Service  │
│   (Kong/Nginx)  │◄──►│   (Firebase)    │◄──►│   (Node.js)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Payment Svc    │    │   AI Service    │    │  Notification   │
│   (Stripe)      │    │   (OpenAI)      │    │   (FCM/Push)    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Booking Svc    │    │  Analytics Svc  │    │  Storage Svc    │
│ (Booking.com)   │    │   (BigQuery)    │    │   (S3/GCS)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘</code></pre>
<p><strong>Patterns architecturaux avancés :</strong> 1. <strong>Event
Sourcing</strong> : Traçabilité complète des actions 2.
<strong>CQRS</strong> : Séparation lecture/écriture 3. <strong>Saga
Pattern</strong> : Gestion des transactions distribuées 4.
<strong>Circuit Breaker</strong> : Résilience aux pannes 5.
<strong>Bulkhead Pattern</strong> : Isolation des services</p>
<h4 id="modèle-de-données-conceptuel">3.3 Modèle de données
conceptuel</h4>
<p><strong>Entités principales et relations :</strong></p>
<pre class="mermaid"><code>erDiagram
    USER ||--o{ GROUP : &quot;belongs to&quot;
    USER ||--o{ EVENT : &quot;participates in&quot;
    USER ||--o{ EXPENSE : &quot;contributes to&quot;
    USER ||--o{ VOTE : &quot;casts&quot;
    USER ||--o{ PROPOSAL : &quot;creates&quot;
    
    GROUP ||--o{ EVENT : &quot;contains&quot;
    GROUP ||--o{ EXPENSE : &quot;has&quot;
    GROUP ||--o{ PROPOSAL : &quot;receives&quot;
    
    EVENT ||--o{ EXPENSE : &quot;generates&quot;
    EVENT ||--o{ VOTE : &quot;includes&quot;
    EVENT ||--o{ PROPOSAL : &quot;receives&quot;
    
    PROPOSAL ||--o{ VOTE : &quot;receives&quot;
    
    USER {
        string id PK
        string email
        string firstName
        string lastName
        string avatar
        date createdAt
        object preferences
        array groups
        array events
    }
    
    GROUP {
        string id PK
        string name
        string description
        array members
        array admins
        string status
        date createdAt
        object settings
    }
    
    EVENT {
        string id PK
        string title
        string description
        string groupId FK
        string status
        date date
        string location
        array attendees
        string createdBy FK
        boolean aiGenerated
        object plan
    }
    
    EXPENSE {
        string id PK
        string title
        number amount
        string category
        string groupId FK
        string eventId FK
        string paidBy FK
        array participants
        string status
        object details
    }
    
    PROPOSAL {
        string id PK
        string type
        string value
        string groupId FK
        string eventId FK
        string createdBy FK
        date createdAt
        string status
    }
    
    VOTE {
        string id PK
        string proposalId FK
        string userId FK
        boolean value
        date createdAt
        object metadata
    }</code></pre>
<h4 id="flux-de-données-complexes">3.4 Flux de données complexes</h4>
<p><strong>Architecture de streaming de données :</strong></p>
<pre><code>┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Mobile    │    │     Web     │    │   API       │    │  Database   │
│   App       │───►│   Client    │───►│  Gateway    │───►│  (Firestore)│
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Real-time  │    │   Cache     │    │   Message   │    │  Analytics  │
│  Updates    │    │  (Redis)    │    │   Queue     │    │  (BigQuery) │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Push       │    │  CDN        │    │  Background │    │  Machine    │
│ Notifications│    │(CloudFront) │    │   Jobs      │    │  Learning   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘</code></pre>
<p><strong>Gestion des événements en temps réel :</strong> 1.
<strong>WebSocket</strong> : Communication bidirectionnelle 2.
<strong>Server-Sent Events</strong> : Mises à jour push 3. <strong>Long
Polling</strong> : Fallback pour compatibilité 4. <strong>Service
Workers</strong> : Cache et synchronisation</p>
<h3 id="analyse-concurrentielle-détaillée">4. ANALYSE CONCURRENTIELLE
DÉTAILLÉE</h3>
<h4 id="benchmark-des-concurrents-directs">4.1 Benchmark des concurrents
directs</h4>
<p><strong>Eventbrite :</strong> - <strong>Forces</strong> : Base
utilisateur massive, intégrations nombreuses -
<strong>Faiblesses</strong> : Focus B2B, interface complexe, pas de
collaboration - <strong>Différenciation SocialPlanr</strong> : IA
générative, collaboration démocratique</p>
<p><strong>Meetup :</strong> - <strong>Forces</strong> : Communautés
existantes, découverte d’événements - <strong>Faiblesses</strong> : Pas
de gestion financière, interface datée - <strong>Différenciation
SocialPlanr</strong> : Gestion intégrée, UX moderne</p>
<p><strong>Doodle :</strong> - <strong>Forces</strong> : Simplicité,
adoption large - <strong>Faiblesses</strong> : Fonctionnalités limitées,
pas de gestion d’événements - <strong>Différenciation
SocialPlanr</strong> : Plateforme complète, IA intégrée</p>
<p><strong>Splitwise :</strong> - <strong>Forces</strong> : Gestion
financière spécialisée - <strong>Faiblesses</strong> : Pas
d’organisation d’événements - <strong>Différenciation
SocialPlanr</strong> : Intégration complète événements + finances</p>
<h4 id="analyse-des-concurrents-indirects">4.2 Analyse des concurrents
indirects</h4>
<p><strong>Applications de voyage :</strong> -
<strong>Booking.com</strong> : Hébergement mais pas d’organisation -
<strong>Airbnb Experiences</strong> : Activités mais pas de
collaboration - <strong>TripAdvisor</strong> : Avis mais pas de
planification</p>
<p><strong>Réseaux sociaux :</strong> - <strong>Facebook Events</strong>
: Découverte mais pas de gestion - <strong>WhatsApp Groups</strong> :
Communication mais pas d’organisation - <strong>Discord</strong> :
Communautés mais pas d’événements</p>
<p><strong>Outils de productivité :</strong> - <strong>Google
Calendar</strong> : Planification mais pas de collaboration -
<strong>Trello</strong> : Gestion de projet mais pas d’événements -
<strong>Notion</strong> : Documentation mais pas de planification</p>
<h4 id="matrice-de-positionnement">4.3 Matrice de positionnement</h4>
<p><strong>Axe X : Complexité fonctionnelle</strong> -
<strong>Faible</strong> : Doodle, Splitwise - <strong>Moyenne</strong> :
Eventbrite, Meetup - <strong>Élevée</strong> : SocialPlanr, solutions
d’entreprise</p>
<p><strong>Axe Y : Innovation technologique</strong> -
<strong>Faible</strong> : Outils traditionnels -
<strong>Moyenne</strong> : Applications web modernes -
<strong>Élevée</strong> : SocialPlanr (IA, collaboration avancée)</p>
<p><strong>Positionnement SocialPlanr :</strong> - <strong>Quadrant
supérieur droit</strong> : Complexité élevée + Innovation élevée -
<strong>Avantage concurrentiel</strong> : Unique sur le marché -
<strong>Barrière à l’entrée</strong> : Technologie avancée requise</p>
<h4 id="stratégie-de-différenciation">4.4 Stratégie de
différenciation</h4>
<p><strong>Innovation produit :</strong> 1. <strong>IA
générative</strong> : Plans automatiques personnalisés 2.
<strong>Collaboration démocratique</strong> : Système de vote avancé 3.
<strong>Gestion financière intégrée</strong> : Cagnotte et
remboursements 4. <strong>Expérience utilisateur premium</strong> :
Interface moderne et intuitive</p>
<p><strong>Innovation technologique :</strong> 1. <strong>Architecture
microservices</strong> : Scalabilité et résilience 2. <strong>Temps
réel</strong> : Synchronisation instantanée 3.
<strong>Mobile-first</strong> : Optimisation pour les appareils mobiles
4. <strong>Cloud-native</strong> : Déploiement et scaling
automatiques</p>
<p><strong>Innovation business :</strong> 1. <strong>Modèle
freemium</strong> : Gratuit + fonctionnalités premium 2.
<strong>Écosystème de partenaires</strong> : APIs et intégrations 3.
<strong>Monétisation des données</strong> : Insights anonymisés 4.
<strong>Licences entreprise</strong> : Solutions B2B</p>
<hr />
<p><em>[Suite dans la partie suivante…]</em></p>
<h1 id="rapport-technique-complexe---socialplanr-partie-2">RAPPORT
TECHNIQUE COMPLEXE - SOCIALPLANR (PARTIE 2)</h1>
<h2
id="architecture-technique-avancée-et-modèles-de-données-complexes">Architecture
technique avancée et modèles de données complexes</h2>
<hr />
<h2 id="partie-2-architecture-technique-avancée-1">PARTIE 2 :
ARCHITECTURE TECHNIQUE AVANCÉE</h2>
<h3 id="architecture-système-distribuée">5. ARCHITECTURE SYSTÈME
DISTRIBUÉE</h3>
<h4 id="architecture-en-couches-distribuées">5.1 Architecture en couches
distribuées</h4>
<p><strong>Présentation Layer (Frontend) :</strong></p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                    PRESENTATION LAYER                      │
├─────────────────────────────────────────────────────────────┤
│  Mobile App (React Native)  │  Web App (Next.js)         │
│  ├── Expo Router           │  ├── App Router             │
│  ├── Navigation Stack      │  ├── Server Components      │
│  ├── State Management      │  ├── Client Components      │
│  └── UI Components        │  └── Styling (Tailwind)     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     API GATEWAY LAYER                      │
├─────────────────────────────────────────────────────────────┤
│  Kong/Nginx Reverse Proxy                                  │
│  ├── Rate Limiting        │  ├── Authentication          │
│  ├── Load Balancing       │  ├── Request Routing         │
│  ├── SSL Termination      │  └── CORS Management         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    BUSINESS LOGIC LAYER                    │
├─────────────────────────────────────────────────────────────┤
│  Auth Service    │  Event Service  │  Payment Service     │
│  ├── JWT        │  ├── CRUD       │  ├── Stripe          │
│  ├── OAuth      │  ├── Validation │  ├── Refunds         │
│  └── MFA        │  └── Business   │  └── Analytics       │
│                 │                 │                       │
│  AI Service     │  Notification   │  Booking Service      │
│  ├── OpenAI     │  ├── Push       │  ├── Booking.com     │
│  ├── ML Models  │  ├── Email      │  ├── Hotels          │
│  └── Analytics  │  └── SMS        │  └── Activities      │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    DATA ACCESS LAYER                       │
├─────────────────────────────────────────────────────────────┤
│  Primary Database (PostgreSQL)  │  Cache (Redis)          │
│  ├── Users                     │  ├── Sessions            │
│  ├── Groups                    │  ├── Events              │
│  ├── Events                    │  ├── Votes               │
│  └── Expenses                  │  └── Analytics           │
│                                │                          │
│  Search Engine (Elasticsearch) │  File Storage (S3)      │
│  ├── Event Search              │  ├── User Avatars        │
│  ├── Location Search           │  ├── Event Images        │
│  └── Full-text Search          │  └── Documents           │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h4 id="patterns-architecturaux-avancés">5.2 Patterns architecturaux
avancés</h4>
<p><strong>Event Sourcing Pattern :</strong></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Store</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EventStore {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  events<span class="op">:</span> DomainEvent[]<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">append</span>(event<span class="op">:</span> DomainEvent)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getEvents</span>(aggregateId<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>DomainEvent[]<span class="op">&gt;;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Domain Events</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DomainEvent {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  aggregateId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  version<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Types</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> EventCreated <span class="op">=</span> DomainEvent <span class="op">&amp;</span> {</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="st">&#39;EventCreated&#39;</span><span class="op">;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    date<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    location<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    createdBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> VoteCast <span class="op">=</span> DomainEvent <span class="op">&amp;</span> {</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="st">&#39;VoteCast&#39;</span><span class="op">;</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    proposalId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    userId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    value<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ExpenseAdded <span class="op">=</span> DomainEvent <span class="op">&amp;</span> {</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="st">&#39;ExpenseAdded&#39;</span><span class="op">;</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    category<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    paidBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    participants<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<p><strong>CQRS Pattern (Command Query Responsibility Segregation)
:</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Command Side</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Command {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> CommandHandler<span class="op">&lt;</span>T <span class="kw">extends</span> Command<span class="op">&gt;</span> {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle</span>(command<span class="op">:</span> T)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Query Side</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Query {</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  parameters<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> QueryHandler<span class="op">&lt;</span>T <span class="kw">extends</span> Query<span class="op">,</span> R<span class="op">&gt;</span> {</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">handle</span>(query<span class="op">:</span> T)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>R<span class="op">&gt;;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Implementation</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CreateEventCommand <span class="kw">implements</span> Command {</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  id <span class="op">=</span> <span class="fu">generateId</span>()<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;CreateEvent&#39;</span><span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    date<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    location<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    groupId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  timestamp <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GetUserEventsQuery <span class="kw">implements</span> Query {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> <span class="op">=</span> <span class="st">&#39;GetUserEvents&#39;</span><span class="op">;</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  parameters<span class="op">:</span> {</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    userId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    offset<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Saga Pattern pour transactions distribuées :</strong></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Saga Coordinator</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventCreationSaga {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">execute</span>(command<span class="op">:</span> CreateEventCommand)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 1: Create Event</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> <span class="bu">event</span> <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventService</span><span class="op">.</span><span class="fu">create</span>(command<span class="op">.</span><span class="at">data</span>)<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 2: Notify Group Members</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">notificationService</span><span class="op">.</span><span class="fu">notifyGroupMembers</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        command<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">groupId</span><span class="op">,</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="vs">`New event: </span><span class="sc">${</span>command<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">title</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 3: Update Analytics</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">analyticsService</span><span class="op">.</span><span class="fu">trackEventCreation</span>(<span class="bu">event</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Step 4: Generate AI Suggestions</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">aiService</span><span class="op">.</span><span class="fu">generateEventSuggestions</span>(<span class="bu">event</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Compensation: Rollback all changes</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">compensate</span>(command)<span class="op">;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> error<span class="op">;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">compensate</span>(command<span class="op">:</span> CreateEventCommand)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rollback logic</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventService</span><span class="op">.</span><span class="fu">delete</span>(command<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">notificationService</span><span class="op">.</span><span class="fu">cancelNotifications</span>(command<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">analyticsService</span><span class="op">.</span><span class="fu">rollbackEventCreation</span>(command<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="architecture-de-microservices">5.3 Architecture de
microservices</h4>
<p><strong>Service Discovery et Load Balancing :</strong></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Docker Compose pour développement</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;3.8&#39;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">services</span><span class="kw">:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">api-gateway</span><span class="kw">:</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> kong:latest</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8000:8000&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8443:8443&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_DATABASE</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">KONG_PG_HOST</span><span class="kw">:</span><span class="at"> postgres</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">depends_on</span><span class="kw">:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">auth-service</span><span class="kw">:</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./services/auth</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3001:3001&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://user:pass@postgres:5432/auth</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">JWT_SECRET</span><span class="kw">:</span><span class="at"> ${JWT_SECRET}</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">event-service</span><span class="kw">:</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./services/event</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3002:3002&quot;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://user:pass@postgres:5432/events</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">REDIS_URL</span><span class="kw">:</span><span class="at"> redis://redis:6379</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">payment-service</span><span class="kw">:</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./services/payment</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3003:3003&quot;</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">STRIPE_SECRET_KEY</span><span class="kw">:</span><span class="at"> ${STRIPE_SECRET_KEY}</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://user:pass@postgres:5432/payments</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">ai-service</span><span class="kw">:</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./services/ai</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3004:3004&quot;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">OPENAI_API_KEY</span><span class="kw">:</span><span class="at"> ${OPENAI_API_KEY}</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://user:pass@postgres:5432/ai</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">notification-service</span><span class="kw">:</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">build</span><span class="kw">:</span><span class="at"> ./services/notification</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;3005:3005&quot;</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">FIREBASE_SERVER_KEY</span><span class="kw">:</span><span class="at"> ${FIREBASE_SERVER_KEY}</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">DATABASE_URL</span><span class="kw">:</span><span class="at"> postgresql://user:pass@postgres:5432/notifications</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres</span><span class="kw">:</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> postgres:15</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_PASSWORD</span><span class="kw">:</span><span class="at"> password</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">POSTGRES_DB</span><span class="kw">:</span><span class="at"> socialplanr</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> postgres_data:/var/lib/postgresql/data</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis</span><span class="kw">:</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> redis:7-alpine</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;6379:6379&quot;</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> redis_data:/data</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="at">      </span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">elasticsearch</span><span class="kw">:</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">image</span><span class="kw">:</span><span class="at"> elasticsearch:8.8.0</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">environment</span><span class="kw">:</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> discovery.type=single-node</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> xpack.security.enabled=false</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">ports</span><span class="kw">:</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9200:9200&quot;</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> elasticsearch_data:/usr/share/elasticsearch/data</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="fu">volumes</span><span class="kw">:</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">postgres_data</span><span class="kw">:</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">redis_data</span><span class="kw">:</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">elasticsearch_data</span><span class="kw">:</span></span></code></pre></div>
<h4 id="communication-inter-services">5.4 Communication
inter-services</h4>
<p><strong>Message Queue avec RabbitMQ :</strong></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Message Broker Interface</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> MessageBroker {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">publish</span>(exchange<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> routingKey<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> message<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subscribe</span>(queue<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> handler<span class="op">:</span> (message<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span>)<span class="op">:</span> <span class="dt">void</span><span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Bus Implementation</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventBus <span class="kw">implements</span> MessageBroker {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> connection<span class="op">:</span> amqp<span class="op">.</span><span class="at">Connection</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> channel<span class="op">:</span> amqp<span class="op">.</span><span class="at">Channel</span><span class="op">;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">publish</span>(exchange<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> routingKey<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> message<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">channel</span><span class="op">.</span><span class="fu">assertExchange</span>(exchange<span class="op">,</span> <span class="st">&#39;topic&#39;</span><span class="op">,</span> { durable<span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">channel</span><span class="op">.</span><span class="fu">publish</span>(exchange<span class="op">,</span> routingKey<span class="op">,</span> <span class="bu">Buffer</span><span class="op">.</span><span class="fu">from</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(message)))<span class="op">;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">subscribe</span>(queue<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> handler<span class="op">:</span> (message<span class="op">:</span> <span class="dt">any</span>) <span class="kw">=&gt;</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">channel</span><span class="op">.</span><span class="fu">assertQueue</span>(queue<span class="op">,</span> { durable<span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">channel</span><span class="op">.</span><span class="fu">consume</span>(queue<span class="op">,</span> <span class="kw">async</span> (msg) <span class="kw">=&gt;</span> {</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (msg) {</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> content <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(msg<span class="op">.</span><span class="at">content</span><span class="op">.</span><span class="fu">toString</span>())<span class="op">;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="fu">handler</span>(content)<span class="op">;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="at">channel</span><span class="op">.</span><span class="fu">ack</span>(msg)<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Types</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> UserCreatedEvent {</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">&#39;UserCreated&#39;</span><span class="op">;</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    userId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    firstName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    lastName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EventCreatedEvent {</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">&#39;EventCreated&#39;</span><span class="op">;</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    eventId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    groupId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    createdBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> VoteCastEvent {</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">&#39;VoteCast&#39;</span><span class="op">;</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> {</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    proposalId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    userId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    value<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="modèles-de-données-complexes">6. MODÈLES DE DONNÉES
COMPLEXES</h3>
<h4 id="schéma-de-base-de-données-postgresql">6.1 Schéma de base de
données PostgreSQL</h4>
<div class="sourceCode" id="cb10"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Users Table</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    email <span class="dt">VARCHAR</span>(<span class="dv">255</span>) <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    first_name <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    last_name <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    display_name <span class="dt">VARCHAR</span>(<span class="dv">200</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    avatar_url TEXT,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    phone_number <span class="dt">VARCHAR</span>(<span class="dv">20</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    date_of_birth <span class="dt">DATE</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    last_login_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    is_active <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">TRUE</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    is_verified <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    preferences JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- Groups Table</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">groups</span> (</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">VARCHAR</span>(<span class="dv">200</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    description TEXT,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    avatar_url TEXT,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;active&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;active&#39;</span>, <span class="st">&#39;archived&#39;</span>, <span class="st">&#39;deleted&#39;</span>)),</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    settings JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">-- Group Members Junction Table</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> group_members (</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_id</span> UUID <span class="kw">REFERENCES</span> <span class="kw">groups</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">role</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;member&#39;</span> <span class="kw">CHECK</span> (<span class="kw">role</span> <span class="kw">IN</span> (<span class="st">&#39;admin&#39;</span>, <span class="st">&#39;moderator&#39;</span>, <span class="st">&#39;member&#39;</span>)),</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    joined_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    invited_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>),</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    is_active <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">TRUE</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(<span class="fu">group_id</span>, user_id)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">-- Events Table</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">events</span> (</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    title <span class="dt">VARCHAR</span>(<span class="dv">200</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    description TEXT,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_id</span> UUID <span class="kw">REFERENCES</span> <span class="kw">groups</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    start_date <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    end_date <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    location <span class="dt">VARCHAR</span>(<span class="dv">500</span>),</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    location_coordinates POINT,</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;planning&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;planning&#39;</span>, <span class="st">&#39;voting&#39;</span>, <span class="st">&#39;confirmed&#39;</span>, <span class="st">&#39;in_progress&#39;</span>, <span class="st">&#39;completed&#39;</span>, <span class="st">&#39;cancelled&#39;</span>)),</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    max_participants <span class="dt">INTEGER</span>,</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    is_public <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    ai_generated <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">FALSE</span>,</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">plan</span> JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span>,</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co">-- Event Participants Junction Table</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> event_participants (</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>    event_id UUID <span class="kw">REFERENCES</span> <span class="kw">events</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;invited&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;invited&#39;</span>, <span class="st">&#39;confirmed&#39;</span>, <span class="st">&#39;declined&#39;</span>, <span class="st">&#39;maybe&#39;</span>)),</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>    joined_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>    response_message TEXT,</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(event_id, user_id)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co">-- Proposals Table</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> proposals (</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>    event_id UUID <span class="kw">REFERENCES</span> <span class="kw">events</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_id</span> UUID <span class="kw">REFERENCES</span> <span class="kw">groups</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">CHECK</span> (<span class="kw">type</span> <span class="kw">IN</span> (<span class="st">&#39;date&#39;</span>, <span class="st">&#39;location&#39;</span>, <span class="st">&#39;activity&#39;</span>, <span class="st">&#39;budget&#39;</span>)),</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">value</span> TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;active&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;active&#39;</span>, <span class="st">&#39;accepted&#39;</span>, <span class="st">&#39;rejected&#39;</span>, <span class="st">&#39;expired&#39;</span>)),</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="co">-- Votes Table</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> votes (</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>    proposal_id UUID <span class="kw">REFERENCES</span> proposals(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">value</span> <span class="dt">BOOLEAN</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    <span class="kw">comment</span> TEXT,</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(proposal_id, user_id)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="co">-- Expenses Table</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> expenses (</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    title <span class="dt">VARCHAR</span>(<span class="dv">200</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    description TEXT,</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    amount <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>    currency <span class="dt">VARCHAR</span>(<span class="dv">3</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;EUR&#39;</span>,</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">category</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">CHECK</span> (<span class="kw">category</span> <span class="kw">IN</span> (<span class="st">&#39;accommodation&#39;</span>, <span class="st">&#39;transport&#39;</span>, <span class="st">&#39;food&#39;</span>, <span class="st">&#39;entertainment&#39;</span>, <span class="st">&#39;other&#39;</span>)),</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_id</span> UUID <span class="kw">REFERENCES</span> <span class="kw">groups</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>    event_id UUID <span class="kw">REFERENCES</span> <span class="kw">events</span>(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">SET</span> <span class="kw">NULL</span>,</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>    paid_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>    created_by UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>    updated_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span> <span class="dt">DATE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;pending&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;pending&#39;</span>, <span class="st">&#39;paid&#39;</span>, <span class="st">&#39;settled&#39;</span>, <span class="st">&#39;cancelled&#39;</span>)),</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>    receipt_url TEXT,</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a><span class="co">-- Expense Participants Junction Table</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> expense_participants (</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>    expense_id UUID <span class="kw">REFERENCES</span> expenses(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>    amount_share <span class="dt">DECIMAL</span>(<span class="dv">10</span>,<span class="dv">2</span>),</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>    percentage_share <span class="dt">DECIMAL</span>(<span class="dv">5</span>,<span class="dv">2</span>),</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;pending&#39;</span> <span class="kw">CHECK</span> (status <span class="kw">IN</span> (<span class="st">&#39;pending&#39;</span>, <span class="st">&#39;paid&#39;</span>, <span class="st">&#39;exempt&#39;</span>)),</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    paid_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNIQUE</span>(expense_id, user_id)</span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a><span class="co">-- Notifications Table</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> notifications (</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">CASCADE</span>,</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>    title <span class="dt">VARCHAR</span>(<span class="dv">200</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>    message TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">data</span> JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span>,</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>    created_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>    read_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>    sent_at <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>,</span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>    delivery_status <span class="dt">VARCHAR</span>(<span class="dv">50</span>) <span class="kw">DEFAULT</span> <span class="st">&#39;pending&#39;</span> <span class="kw">CHECK</span> (delivery_status <span class="kw">IN</span> (<span class="st">&#39;pending&#39;</span>, <span class="st">&#39;sent&#39;</span>, <span class="st">&#39;delivered&#39;</span>, <span class="st">&#39;failed&#39;</span>)),</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a><span class="co">-- Analytics Events Table</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> analytics_events (</span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> UUID <span class="kw">PRIMARY</span> <span class="kw">KEY</span> <span class="kw">DEFAULT</span> gen_random_uuid(),</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>    user_id UUID <span class="kw">REFERENCES</span> users(<span class="kw">id</span>) <span class="kw">ON</span> <span class="kw">DELETE</span> <span class="kw">SET</span> <span class="kw">NULL</span>,</span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>    session_id <span class="dt">VARCHAR</span>(<span class="dv">255</span>),</span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>    event_type <span class="dt">VARCHAR</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>    event_data JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span>,</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">timestamp</span> <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> <span class="kw">DEFAULT</span> NOW(),</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>    user_agent TEXT,</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>    ip_address INET,</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>    metadata JSONB <span class="kw">DEFAULT</span> <span class="st">&#39;{}&#39;</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a><span class="co">-- Indexes for Performance</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_users_email <span class="kw">ON</span> users(email);</span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_users_created_at <span class="kw">ON</span> users(created_at);</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_groups_created_by <span class="kw">ON</span> <span class="kw">groups</span>(created_by);</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_group_members_group_id <span class="kw">ON</span> group_members(<span class="fu">group_id</span>);</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_group_members_user_id <span class="kw">ON</span> group_members(user_id);</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_events_group_id <span class="kw">ON</span> <span class="kw">events</span>(<span class="fu">group_id</span>);</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_events_created_by <span class="kw">ON</span> <span class="kw">events</span>(created_by);</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_events_start_date <span class="kw">ON</span> <span class="kw">events</span>(start_date);</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_events_status <span class="kw">ON</span> <span class="kw">events</span>(status);</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_event_participants_event_id <span class="kw">ON</span> event_participants(event_id);</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_event_participants_user_id <span class="kw">ON</span> event_participants(user_id);</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_proposals_event_id <span class="kw">ON</span> proposals(event_id);</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_proposals_group_id <span class="kw">ON</span> proposals(<span class="fu">group_id</span>);</span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_votes_proposal_id <span class="kw">ON</span> votes(proposal_id);</span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_votes_user_id <span class="kw">ON</span> votes(user_id);</span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_expenses_group_id <span class="kw">ON</span> expenses(<span class="fu">group_id</span>);</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_expenses_event_id <span class="kw">ON</span> expenses(event_id);</span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_expenses_paid_by <span class="kw">ON</span> expenses(paid_by);</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_expense_participants_expense_id <span class="kw">ON</span> expense_participants(expense_id);</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_notifications_user_id <span class="kw">ON</span> notifications(user_id);</span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_notifications_created_at <span class="kw">ON</span> notifications(created_at);</span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_analytics_events_user_id <span class="kw">ON</span> analytics_events(user_id);</span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_analytics_events_timestamp <span class="kw">ON</span> analytics_events(<span class="dt">timestamp</span>);</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_analytics_events_event_type <span class="kw">ON</span> analytics_events(event_type);</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a><span class="co">-- Full-text Search Indexes</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_events_search <span class="kw">ON</span> <span class="kw">events</span> <span class="kw">USING</span> gin(to_tsvector(<span class="st">&#39;english&#39;</span>, title <span class="op">||</span> <span class="st">&#39; &#39;</span> <span class="op">||</span> <span class="fu">COALESCE</span>(description, <span class="st">&#39;&#39;</span>)));</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_groups_search <span class="kw">ON</span> <span class="kw">groups</span> <span class="kw">USING</span> gin(to_tsvector(<span class="st">&#39;english&#39;</span>, name <span class="op">||</span> <span class="st">&#39; &#39;</span> <span class="op">||</span> <span class="fu">COALESCE</span>(description, <span class="st">&#39;&#39;</span>)));</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_users_search <span class="kw">ON</span> users <span class="kw">USING</span> gin(to_tsvector(<span class="st">&#39;english&#39;</span>, first_name <span class="op">||</span> <span class="st">&#39; &#39;</span> <span class="op">||</span> last_name <span class="op">||</span> <span class="st">&#39; &#39;</span> <span class="op">||</span> <span class="fu">COALESCE</span>(display_name, <span class="st">&#39;&#39;</span>)));</span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a><span class="co">-- Triggers for Updated At</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> update_updated_at_column()</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>RETURNS <span class="kw">TRIGGER</span> <span class="kw">AS</span> $$</span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>    <span class="kw">NEW</span>.updated_at <span class="op">=</span> NOW();</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">RETURN</span> <span class="kw">NEW</span>;</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>$$ language <span class="st">&#39;plpgsql&#39;</span>;</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_users_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> users <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_groups_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> <span class="kw">groups</span> <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_events_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> <span class="kw">events</span> <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_proposals_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> proposals <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_votes_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> votes <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> update_expenses_updated_at <span class="kw">BEFORE</span> <span class="kw">UPDATE</span> <span class="kw">ON</span> expenses <span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span> <span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> update_updated_at_column();</span></code></pre></div>
<h4 id="modèles-typescript-avancés">6.2 Modèles TypeScript avancés</h4>
<div class="sourceCode" id="cb11"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Base Types</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> UUID <span class="op">=</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Email <span class="op">=</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Timestamp <span class="op">=</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Enums</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> UserRole {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  ADMIN <span class="op">=</span> <span class="st">&#39;admin&#39;</span><span class="op">,</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  MODERATOR <span class="op">=</span> <span class="st">&#39;moderator&#39;</span><span class="op">,</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  MEMBER <span class="op">=</span> <span class="st">&#39;member&#39;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> EventStatus {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  PLANNING <span class="op">=</span> <span class="st">&#39;planning&#39;</span><span class="op">,</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  VOTING <span class="op">=</span> <span class="st">&#39;voting&#39;</span><span class="op">,</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  CONFIRMED <span class="op">=</span> <span class="st">&#39;confirmed&#39;</span><span class="op">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  IN_PROGRESS <span class="op">=</span> <span class="st">&#39;in_progress&#39;</span><span class="op">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  COMPLETED <span class="op">=</span> <span class="st">&#39;completed&#39;</span><span class="op">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  CANCELLED <span class="op">=</span> <span class="st">&#39;cancelled&#39;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> ExpenseCategory {</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  ACCOMMODATION <span class="op">=</span> <span class="st">&#39;accommodation&#39;</span><span class="op">,</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  TRANSPORT <span class="op">=</span> <span class="st">&#39;transport&#39;</span><span class="op">,</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  FOOD <span class="op">=</span> <span class="st">&#39;food&#39;</span><span class="op">,</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  ENTERTAINMENT <span class="op">=</span> <span class="st">&#39;entertainment&#39;</span><span class="op">,</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  OTHER <span class="op">=</span> <span class="st">&#39;other&#39;</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> ProposalType {</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  DATE <span class="op">=</span> <span class="st">&#39;date&#39;</span><span class="op">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  LOCATION <span class="op">=</span> <span class="st">&#39;location&#39;</span><span class="op">,</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  ACTIVITY <span class="op">=</span> <span class="st">&#39;activity&#39;</span><span class="op">,</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  BUDGET <span class="op">=</span> <span class="st">&#39;budget&#39;</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> NotificationType {</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  EVENT_INVITATION <span class="op">=</span> <span class="st">&#39;event_invitation&#39;</span><span class="op">,</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  VOTE_REMINDER <span class="op">=</span> <span class="st">&#39;vote_reminder&#39;</span><span class="op">,</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  EXPENSE_ADDED <span class="op">=</span> <span class="st">&#39;expense_added&#39;</span><span class="op">,</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  PAYMENT_RECEIVED <span class="op">=</span> <span class="st">&#39;payment_received&#39;</span><span class="op">,</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  GROUP_UPDATE <span class="op">=</span> <span class="st">&#39;group_update&#39;</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Base Interfaces</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> BaseEntity {</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  updatedAt<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> User <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> Email<span class="op">;</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  firstName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  lastName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  displayName<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  avatarUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  phoneNumber<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  dateOfBirth<span class="op">?:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  lastLoginAt<span class="op">?:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>  isActive<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  isVerified<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  preferences<span class="op">:</span> UserPreferences<span class="op">;</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> UserPreferences {</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>  language<span class="op">:</span> <span class="st">&#39;fr&#39;</span> <span class="op">|</span> <span class="st">&#39;en&#39;</span> <span class="op">|</span> <span class="st">&#39;es&#39;</span> <span class="op">|</span> <span class="st">&#39;de&#39;</span><span class="op">;</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  timezone<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span> <span class="op">|</span> <span class="st">&#39;USD&#39;</span> <span class="op">|</span> <span class="st">&#39;GBP&#39;</span><span class="op">;</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  notifications<span class="op">:</span> {</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    push<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    sms<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  privacy<span class="op">:</span> {</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>    profileVisibility<span class="op">:</span> <span class="st">&#39;public&#39;</span> <span class="op">|</span> <span class="st">&#39;friends&#39;</span> <span class="op">|</span> <span class="st">&#39;private&#39;</span><span class="op">;</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>    showEmail<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    showPhone<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>  theme<span class="op">:</span> <span class="st">&#39;light&#39;</span> <span class="op">|</span> <span class="st">&#39;dark&#39;</span> <span class="op">|</span> <span class="st">&#39;auto&#39;</span><span class="op">;</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Group <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  avatarUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;active&#39;</span> <span class="op">|</span> <span class="st">&#39;archived&#39;</span> <span class="op">|</span> <span class="st">&#39;deleted&#39;</span><span class="op">;</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>  settings<span class="op">:</span> GroupSettings<span class="op">;</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> GroupSettings {</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  allowMemberInvites<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>  requireApprovalForEvents<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>  maxMembers<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  defaultEventVisibility<span class="op">:</span> <span class="st">&#39;public&#39;</span> <span class="op">|</span> <span class="st">&#39;private&#39;</span><span class="op">;</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>  autoAcceptEvents<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  notificationSettings<span class="op">:</span> {</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>    eventCreated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    eventUpdated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    expenseAdded<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    voteCast<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> GroupMember <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>  role<span class="op">:</span> UserRole<span class="op">;</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>  joinedAt<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>  invitedBy<span class="op">?:</span> UUID<span class="op">;</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  isActive<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> <span class="bu">Event</span> <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  startDate<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  endDate<span class="op">?:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>  location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>  locationCoordinates<span class="op">?:</span> {</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>    latitude<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    longitude<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> EventStatus<span class="op">;</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>  maxParticipants<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>  isPublic<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>  aiGenerated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>  plan<span class="op">:</span> EventPlan<span class="op">;</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EventPlan {</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  activities<span class="op">:</span> Activity[]<span class="op">;</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>  timeline<span class="op">:</span> TimelineItem[]<span class="op">;</span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>  budget<span class="op">:</span> Budget<span class="op">;</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>  recommendations<span class="op">:</span> Recommendation[]<span class="op">;</span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Activity {</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>  duration<span class="op">:</span> <span class="dt">number</span><span class="op">;</span> <span class="co">// minutes</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>  cost<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>  location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>  category<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> TimelineItem {</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>  time<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>  activity<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>  location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>  notes<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Budget {</span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>  total<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  perPerson<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  breakdown<span class="op">:</span> {</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>    accommodation<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>    transport<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>    food<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>    entertainment<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>    other<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Recommendation {</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">&#39;activity&#39;</span> <span class="op">|</span> <span class="st">&#39;restaurant&#39;</span> <span class="op">|</span> <span class="st">&#39;hotel&#39;</span> <span class="op">|</span> <span class="st">&#39;transport&#39;</span><span class="op">;</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>  rating<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>  url<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EventParticipant <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>  eventId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;invited&#39;</span> <span class="op">|</span> <span class="st">&#39;confirmed&#39;</span> <span class="op">|</span> <span class="st">&#39;declined&#39;</span> <span class="op">|</span> <span class="st">&#39;maybe&#39;</span><span class="op">;</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>  joinedAt<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>  responseMessage<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Proposal <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>  eventId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> ProposalType<span class="op">;</span></span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;active&#39;</span> <span class="op">|</span> <span class="st">&#39;accepted&#39;</span> <span class="op">|</span> <span class="st">&#39;rejected&#39;</span> <span class="op">|</span> <span class="st">&#39;expired&#39;</span><span class="op">;</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Vote <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>  proposalId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>  value<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>  comment<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Expense <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>  amount<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span> <span class="op">|</span> <span class="st">&#39;USD&#39;</span> <span class="op">|</span> <span class="st">&#39;GBP&#39;</span><span class="op">;</span></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>  category<span class="op">:</span> ExpenseCategory<span class="op">;</span></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>  eventId<span class="op">?:</span> UUID<span class="op">;</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>  paidBy<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>  date<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;pending&#39;</span> <span class="op">|</span> <span class="st">&#39;paid&#39;</span> <span class="op">|</span> <span class="st">&#39;settled&#39;</span> <span class="op">|</span> <span class="st">&#39;cancelled&#39;</span><span class="op">;</span></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>  receiptUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ExpenseParticipant <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>  expenseId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>  amountShare<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>  percentageShare<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;pending&#39;</span> <span class="op">|</span> <span class="st">&#39;paid&#39;</span> <span class="op">|</span> <span class="st">&#39;exempt&#39;</span><span class="op">;</span></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>  paidAt<span class="op">?:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> <span class="bu">Notification</span> <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> NotificationType<span class="op">;</span></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a>  readAt<span class="op">?:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>  sentAt<span class="op">?:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a>  deliveryStatus<span class="op">:</span> <span class="st">&#39;pending&#39;</span> <span class="op">|</span> <span class="st">&#39;sent&#39;</span> <span class="op">|</span> <span class="st">&#39;delivered&#39;</span> <span class="op">|</span> <span class="st">&#39;failed&#39;</span><span class="op">;</span></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> AnalyticsEvent <span class="kw">extends</span> BaseEntity {</span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">?:</span> UUID<span class="op">;</span></span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>  sessionId<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>  eventData<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a>  userAgent<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>  ipAddress<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a><span class="co">// Utility Types</span></span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> DeepPartial<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">=</span> {</span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>  [P <span class="kw">in</span> <span class="kw">keyof</span> T]<span class="op">?:</span> T[P] <span class="kw">extends</span> <span class="dt">object</span> <span class="op">?</span> DeepPartial<span class="op">&lt;</span>T[P]<span class="op">&gt;</span> <span class="op">:</span> T[P]<span class="op">;</span></span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> RequireFields<span class="op">&lt;</span>T<span class="op">,</span> K <span class="kw">extends</span> <span class="kw">keyof</span> T<span class="op">&gt;</span> <span class="op">=</span> T <span class="op">&amp;</span> { [P <span class="kw">in</span> K]<span class="op">-?:</span> T[P] }<span class="op">;</span></span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> OptionalFields<span class="op">&lt;</span>T<span class="op">,</span> K <span class="kw">extends</span> <span class="kw">keyof</span> T<span class="op">&gt;</span> <span class="op">=</span> <span class="bu">Omit</span><span class="op">&lt;</span>T<span class="op">,</span> K<span class="op">&gt;</span> <span class="op">&amp;</span> <span class="bu">Partial</span><span class="op">&lt;</span><span class="bu">Pick</span><span class="op">&lt;</span>T<span class="op">,</span> K<span class="op">&gt;&gt;;</span></span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a><span class="co">// API Response Types</span></span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ApiResponse<span class="op">&lt;</span>T<span class="op">&gt;</span> {</span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a>  success<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>  data<span class="op">?:</span> T<span class="op">;</span></span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a>  error<span class="op">?:</span> {</span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a>    code<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a>    message<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a>    details<span class="op">?:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>  meta<span class="op">?:</span> {</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a>    page<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true" tabindex="-1"></a>    total<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true" tabindex="-1"></a>    hasMore<span class="op">?:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> PaginatedResponse<span class="op">&lt;</span>T<span class="op">&gt;</span> {</span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a>  items<span class="op">:</span> T[]<span class="op">;</span></span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true" tabindex="-1"></a>  pagination<span class="op">:</span> {</span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true" tabindex="-1"></a>    page<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a>    limit<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a>    total<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a>    totalPages<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a>    hasNext<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a>    hasPrev<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Types for Event Sourcing</span></span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DomainEvent {</span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a>  aggregateId<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a>  version<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">?:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a><span class="co">// Command Types</span></span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Command {</span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> UUID<span class="op">;</span></span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> Timestamp<span class="op">;</span></span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">?:</span> UUID<span class="op">;</span></span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">?:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a><span class="co">// Query Types</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Query {</span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a>  parameters<span class="op">:</span> <span class="dt">any</span><span class="op">;</span></span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">?:</span> UUID<span class="op">;</span></span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">?:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="modèles-de-données-nosql-firestore">6.3 Modèles de données NoSQL
(Firestore)</h4>
<div class="sourceCode" id="cb12"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Firestore Collections Structure</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> FirestoreCollections {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  users<span class="op">:</span> UserDocument<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  groups<span class="op">:</span> GroupDocument<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  events<span class="op">:</span> EventDocument<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  expenses<span class="op">:</span> ExpenseDocument<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  notifications<span class="op">:</span> NotificationDocument<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  analytics<span class="op">:</span> AnalyticsDocument<span class="op">;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">// User Document</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> UserDocument {</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  uid<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  firstName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  lastName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  displayName<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  avatarUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  phoneNumber<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  dateOfBirth<span class="op">?:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  updatedAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  lastLoginAt<span class="op">?:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  isActive<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  isVerified<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  preferences<span class="op">:</span> {</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    language<span class="op">:</span> <span class="st">&#39;fr&#39;</span> <span class="op">|</span> <span class="st">&#39;en&#39;</span> <span class="op">|</span> <span class="st">&#39;es&#39;</span> <span class="op">|</span> <span class="st">&#39;de&#39;</span><span class="op">;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    timezone<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span> <span class="op">|</span> <span class="st">&#39;USD&#39;</span> <span class="op">|</span> <span class="st">&#39;GBP&#39;</span><span class="op">;</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    notifications<span class="op">:</span> {</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>      push<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>      sms<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    privacy<span class="op">:</span> {</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>      profileVisibility<span class="op">:</span> <span class="st">&#39;public&#39;</span> <span class="op">|</span> <span class="st">&#39;friends&#39;</span> <span class="op">|</span> <span class="st">&#39;private&#39;</span><span class="op">;</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>      showEmail<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>      showPhone<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    theme<span class="op">:</span> <span class="st">&#39;light&#39;</span> <span class="op">|</span> <span class="st">&#39;dark&#39;</span> <span class="op">|</span> <span class="st">&#39;auto&#39;</span><span class="op">;</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Group Document</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> GroupDocument {</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  avatarUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  updatedAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;active&#39;</span> <span class="op">|</span> <span class="st">&#39;archived&#39;</span> <span class="op">|</span> <span class="st">&#39;deleted&#39;</span><span class="op">;</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  members<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span> <span class="co">// User IDs</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  admins<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span> <span class="co">// User IDs</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  settings<span class="op">:</span> {</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>    allowMemberInvites<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    requireApprovalForEvents<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>    maxMembers<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>    defaultEventVisibility<span class="op">:</span> <span class="st">&#39;public&#39;</span> <span class="op">|</span> <span class="st">&#39;private&#39;</span><span class="op">;</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>    autoAcceptEvents<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>    notificationSettings<span class="op">:</span> {</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>      eventCreated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>      eventUpdated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>      expenseAdded<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>      voteCast<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Document</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EventDocument {</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  updatedAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  startDate<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  endDate<span class="op">?:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  locationCoordinates<span class="op">?:</span> {</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    latitude<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>    longitude<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;planning&#39;</span> <span class="op">|</span> <span class="st">&#39;voting&#39;</span> <span class="op">|</span> <span class="st">&#39;confirmed&#39;</span> <span class="op">|</span> <span class="st">&#39;in_progress&#39;</span> <span class="op">|</span> <span class="st">&#39;completed&#39;</span> <span class="op">|</span> <span class="st">&#39;cancelled&#39;</span><span class="op">;</span></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>  attendees<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span> <span class="co">// User IDs</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  maxParticipants<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  isPublic<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>  aiGenerated<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>  plan<span class="op">:</span> {</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>    activities<span class="op">:</span> <span class="bu">Array</span><span class="op">&lt;</span>{</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>      duration<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>      cost<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>      location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>      category<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>    }<span class="op">&gt;;</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>    timeline<span class="op">:</span> <span class="bu">Array</span><span class="op">&lt;</span>{</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>      time<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>      activity<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>      location<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>      notes<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>    }<span class="op">&gt;;</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>    budget<span class="op">:</span> {</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>      total<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>      perPerson<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>      breakdown<span class="op">:</span> {</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>        accommodation<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>        transport<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>        food<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>        entertainment<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>        other<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    recommendations<span class="op">:</span> <span class="bu">Array</span><span class="op">&lt;</span>{</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;activity&#39;</span> <span class="op">|</span> <span class="st">&#39;restaurant&#39;</span> <span class="op">|</span> <span class="st">&#39;hotel&#39;</span> <span class="op">|</span> <span class="st">&#39;transport&#39;</span><span class="op">;</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>      name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>      rating<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>      price<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>      url<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    }<span class="op">&gt;;</span></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a><span class="co">// Expense Document</span></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> ExpenseDocument {</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>  description<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>  amount<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>  currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span> <span class="op">|</span> <span class="st">&#39;USD&#39;</span> <span class="op">|</span> <span class="st">&#39;GBP&#39;</span><span class="op">;</span></span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>  category<span class="op">:</span> <span class="st">&#39;accommodation&#39;</span> <span class="op">|</span> <span class="st">&#39;transport&#39;</span> <span class="op">|</span> <span class="st">&#39;food&#39;</span> <span class="op">|</span> <span class="st">&#39;entertainment&#39;</span> <span class="op">|</span> <span class="st">&#39;other&#39;</span><span class="op">;</span></span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>  groupId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>  eventId<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>  paidBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// User ID</span></span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>  createdBy<span class="op">:</span> <span class="dt">string</span><span class="op">;</span> <span class="co">// User ID</span></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>  updatedAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>  date<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>  status<span class="op">:</span> <span class="st">&#39;pending&#39;</span> <span class="op">|</span> <span class="st">&#39;paid&#39;</span> <span class="op">|</span> <span class="st">&#39;settled&#39;</span> <span class="op">|</span> <span class="st">&#39;cancelled&#39;</span><span class="op">;</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>  participants<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span> <span class="co">// User IDs</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>  receiptUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="co">// Notification Document</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> NotificationDocument {</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>  type<span class="op">:</span> <span class="st">&#39;event_invitation&#39;</span> <span class="op">|</span> <span class="st">&#39;vote_reminder&#39;</span> <span class="op">|</span> <span class="st">&#39;expense_added&#39;</span> <span class="op">|</span> <span class="st">&#39;payment_received&#39;</span> <span class="op">|</span> <span class="st">&#39;group_update&#39;</span><span class="op">;</span></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>  title<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>  data<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>  createdAt<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>  readAt<span class="op">?:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>  sentAt<span class="op">?:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>  deliveryStatus<span class="op">:</span> <span class="st">&#39;pending&#39;</span> <span class="op">|</span> <span class="st">&#39;sent&#39;</span> <span class="op">|</span> <span class="st">&#39;delivered&#39;</span> <span class="op">|</span> <span class="st">&#39;failed&#39;</span><span class="op">;</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a><span class="co">// Analytics Document</span></span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> AnalyticsDocument {</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>  userId<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>  sessionId<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>  eventType<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>  eventData<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>  timestamp<span class="op">:</span> FirebaseFirestore<span class="op">.</span><span class="at">Timestamp</span><span class="op">;</span></span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a>  userAgent<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a>  ipAddress<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>  metadata<span class="op">:</span> <span class="bu">Record</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">any</span><span class="op">&gt;;</span></span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<p><em>[Suite dans la partie suivante…]</em></p>
<h1 id="rapport-technique-complexe---socialplanr-partie-3">RAPPORT
TECHNIQUE COMPLEXE - SOCIALPLANR (PARTIE 3)</h1>
<h2 id="patterns-architecturaux-avancés-et-sécurité">Patterns
architecturaux avancés et sécurité</h2>
<hr />
<h2 id="partie-3-patterns-architecturaux-avancés">PARTIE 3 : PATTERNS
ARCHITECTURAUX AVANCÉS</h2>
<h3 id="patterns-architecturaux-avancés-1">7. PATTERNS ARCHITECTURAUX
AVANCÉS</h3>
<h4 id="domain-driven-design-ddd">7.1 Domain-Driven Design (DDD)</h4>
<p><strong>Bounded Contexts :</strong></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// User Management Context</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">namespace</span> <span class="dt">UserManagement</span> {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> User {</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> UserId<span class="op">;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    email<span class="op">:</span> Email<span class="op">;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    profile<span class="op">:</span> UserProfile<span class="op">;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    preferences<span class="op">:</span> UserPreferences<span class="op">;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    security<span class="op">:</span> UserSecurity<span class="op">;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> UserProfile {</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    firstName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    lastName<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    displayName<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    avatarUrl<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    phoneNumber<span class="op">?:</span> PhoneNumber<span class="op">;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    dateOfBirth<span class="op">?:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> UserPreferences {</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    language<span class="op">:</span> Language<span class="op">;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    timezone<span class="op">:</span> Timezone<span class="op">;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    currency<span class="op">:</span> Currency<span class="op">;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    notifications<span class="op">:</span> NotificationSettings<span class="op">;</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    privacy<span class="op">:</span> PrivacySettings<span class="op">;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    theme<span class="op">:</span> Theme<span class="op">;</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> UserSecurity {</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    isActive<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    isVerified<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    lastLoginAt<span class="op">?:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    failedLoginAttempts<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    lockedUntil<span class="op">?:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Management Context</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="im">namespace</span> <span class="dt">EventManagement</span> {</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> <span class="bu">Event</span> {</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> EventId<span class="op">;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> EventTitle<span class="op">;</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    description<span class="op">?:</span> EventDescription<span class="op">;</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    group<span class="op">:</span> GroupReference<span class="op">;</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    organizer<span class="op">:</span> UserReference<span class="op">;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    schedule<span class="op">:</span> EventSchedule<span class="op">;</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>    location<span class="op">?:</span> EventLocation<span class="op">;</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    participants<span class="op">:</span> ParticipantList<span class="op">;</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> EventStatus<span class="op">;</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    plan<span class="op">?:</span> EventPlan<span class="op">;</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> EventSchedule {</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    startDate<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    endDate<span class="op">?:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    timezone<span class="op">:</span> Timezone<span class="op">;</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> EventLocation {</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    address<span class="op">?:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>    coordinates<span class="op">?:</span> GeoCoordinates<span class="op">;</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> ParticipantList {</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    attendees<span class="op">:</span> UserReference[]<span class="op">;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    maxParticipants<span class="op">?:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>    waitlist<span class="op">:</span> UserReference[]<span class="op">;</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="co">// Financial Management Context</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="im">namespace</span> <span class="dt">FinancialManagement</span> {</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> Expense {</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> ExpenseId<span class="op">;</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    title<span class="op">:</span> ExpenseTitle<span class="op">;</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">:</span> Money<span class="op">;</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    category<span class="op">:</span> ExpenseCategory<span class="op">;</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    group<span class="op">:</span> GroupReference<span class="op">;</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    event<span class="op">?:</span> EventReference<span class="op">;</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    paidBy<span class="op">:</span> UserReference<span class="op">;</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>    participants<span class="op">:</span> ExpenseParticipantList<span class="op">;</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> ExpenseStatus<span class="op">;</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> Money {</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>    currency<span class="op">:</span> Currency<span class="op">;</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> ExpenseParticipantList {</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>    participants<span class="op">:</span> UserReference[]<span class="op">;</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>    shares<span class="op">:</span> <span class="bu">Map</span><span class="op">&lt;</span>UserId<span class="op">,</span> Money<span class="op">&gt;;</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a><span class="co">// Collaboration Context</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="im">namespace</span> <span class="dt">Collaboration</span> {</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> Group {</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> GroupId<span class="op">;</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> GroupName<span class="op">;</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>    description<span class="op">?:</span> GroupDescription<span class="op">;</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>    members<span class="op">:</span> MemberList<span class="op">;</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>    settings<span class="op">:</span> GroupSettings<span class="op">;</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> GroupStatus<span class="op">;</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> MemberList {</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>    members<span class="op">:</span> <span class="bu">Map</span><span class="op">&lt;</span>UserId<span class="op">,</span> MemberRole<span class="op">&gt;;</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>    admins<span class="op">:</span> UserId[]<span class="op">;</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>    moderators<span class="op">:</span> UserId[]<span class="op">;</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> Proposal {</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>    id<span class="op">:</span> ProposalId<span class="op">;</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>    type<span class="op">:</span> ProposalType<span class="op">;</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>    value<span class="op">:</span> ProposalValue<span class="op">;</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>    creator<span class="op">:</span> UserReference<span class="op">;</span></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>    votes<span class="op">:</span> VoteCollection<span class="op">;</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> ProposalStatus<span class="op">;</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>  <span class="kw">interface</span> VoteCollection {</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    votes<span class="op">:</span> <span class="bu">Map</span><span class="op">&lt;</span>UserId<span class="op">,</span> Vote<span class="op">&gt;;</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>    totalVotes<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    acceptedVotes<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>    rejectedVotes<span class="op">:</span> <span class="dt">number</span><span class="op">;</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Value Objects :</strong></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Value Objects Implementation</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Email {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">constructor</span>(<span class="kw">private</span> <span class="kw">readonly</span> value<span class="op">:</span> <span class="dt">string</span>) {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span><span class="op">.</span><span class="fu">isValid</span>(value)) {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Invalid email format&#39;</span>)<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">static</span> <span class="fu">create</span>(email<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> Email {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Email</span>(email)<span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">isValid</span>(email<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="dt">boolean</span> {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> emailRegex <span class="op">=</span> <span class="ss">/</span><span class="sc">^[^\s@]+</span><span class="ss">@</span><span class="sc">[^\s@]+\.[^\s@]+$</span><span class="ss">/</span><span class="op">;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> emailRegex<span class="op">.</span><span class="fu">test</span>(email)<span class="op">;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toString</span>()<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">equals</span>(other<span class="op">:</span> Email)<span class="op">:</span> <span class="dt">boolean</span> {</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">===</span> other<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Money {</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> amount<span class="op">:</span> <span class="dt">number</span><span class="op">,</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> currency<span class="op">:</span> Currency</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amount <span class="op">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Amount cannot be negative&#39;</span>)<span class="op">;</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add</span>(other<span class="op">:</span> Money)<span class="op">:</span> Money {</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">currency</span> <span class="op">!==</span> other<span class="op">.</span><span class="at">currency</span>) {</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Cannot add money with different currencies&#39;</span>)<span class="op">;</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Money</span>(<span class="kw">this</span><span class="op">.</span><span class="at">amount</span> <span class="op">+</span> other<span class="op">.</span><span class="at">amount</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">currency</span>)<span class="op">;</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subtract</span>(other<span class="op">:</span> Money)<span class="op">:</span> Money {</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">this</span><span class="op">.</span><span class="at">currency</span> <span class="op">!==</span> other<span class="op">.</span><span class="at">currency</span>) {</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Cannot subtract money with different currencies&#39;</span>)<span class="op">;</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="at">amount</span> <span class="op">-</span> other<span class="op">.</span><span class="at">amount</span><span class="op">;</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (result <span class="op">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Result cannot be negative&#39;</span>)<span class="op">;</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Money</span>(result<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">currency</span>)<span class="op">;</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">multiply</span>(factor<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> Money {</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Money</span>(<span class="kw">this</span><span class="op">.</span><span class="at">amount</span> <span class="op">*</span> factor<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">currency</span>)<span class="op">;</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">divide</span>(divisor<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> Money {</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (divisor <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Cannot divide by zero&#39;</span>)<span class="op">;</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Money</span>(<span class="kw">this</span><span class="op">.</span><span class="at">amount</span> <span class="op">/</span> divisor<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">currency</span>)<span class="op">;</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toString</span>()<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">amount</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">currency</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GeoCoordinates {</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> latitude<span class="op">:</span> <span class="dt">number</span><span class="op">,</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> longitude<span class="op">:</span> <span class="dt">number</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>  ) {</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (latitude <span class="op">&lt;</span> <span class="op">-</span><span class="dv">90</span> <span class="op">||</span> latitude <span class="op">&gt;</span> <span class="dv">90</span>) {</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Invalid latitude&#39;</span>)<span class="op">;</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (longitude <span class="op">&lt;</span> <span class="op">-</span><span class="dv">180</span> <span class="op">||</span> longitude <span class="op">&gt;</span> <span class="dv">180</span>) {</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">&#39;Invalid longitude&#39;</span>)<span class="op">;</span></span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distanceTo</span>(other<span class="op">:</span> GeoCoordinates)<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> R <span class="op">=</span> <span class="dv">6371</span><span class="op">;</span> <span class="co">// Earth&#39;s radius in kilometers</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dLat <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">toRadians</span>(other<span class="op">.</span><span class="at">latitude</span> <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">latitude</span>)<span class="op">;</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dLon <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">toRadians</span>(other<span class="op">.</span><span class="at">longitude</span> <span class="op">-</span> <span class="kw">this</span><span class="op">.</span><span class="at">longitude</span>)<span class="op">;</span></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> a <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(dLat <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(dLat <span class="op">/</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>              <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">toRadians</span>(<span class="kw">this</span><span class="op">.</span><span class="at">latitude</span>)) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="kw">this</span><span class="op">.</span><span class="fu">toRadians</span>(other<span class="op">.</span><span class="at">latitude</span>)) <span class="op">*</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>              <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(dLon <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(dLon <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> c <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(a)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(<span class="dv">1</span> <span class="op">-</span> a))<span class="op">;</span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> R <span class="op">*</span> c<span class="op">;</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">toRadians</span>(degrees<span class="op">:</span> <span class="dt">number</span>)<span class="op">:</span> <span class="dt">number</span> {</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> degrees <span class="op">*</span> (<span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span>)<span class="op">;</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">toString</span>()<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">latitude</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">longitude</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="repository-pattern-avec-caching">7.2 Repository Pattern avec
Caching</h4>
<div class="sourceCode" id="cb15"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Repository Interface</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Repository<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;</span> {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">findById</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">findAll</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T[]<span class="op">&gt;;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(entity<span class="op">:</span> T)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(id<span class="op">:</span> ID<span class="op">,</span> entity<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>T<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">delete</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exists</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Cached Repository Implementation</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CachedRepository<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;</span> <span class="kw">implements</span> Repository<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;</span> {</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> repository<span class="op">:</span> Repository<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;,</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> cache<span class="op">:</span> Cache<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;,</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> ttl<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">300000</span> <span class="co">// 5 minutes</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findById</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span> {</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Try cache first</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cached <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">get</span>(id)<span class="op">;</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cached) {</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cached<span class="op">;</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Fetch from repository</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> entity <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">findById</span>(id)<span class="op">;</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (entity) {</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(id<span class="op">,</span> entity<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">ttl</span>)<span class="op">;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> entity<span class="op">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findAll</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T[]<span class="op">&gt;</span> {</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// For collections, we might want to cache differently</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">findAll</span>()<span class="op">;</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">save</span>(entity<span class="op">:</span> T)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;</span> {</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> saved <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">save</span>(entity)<span class="op">;</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(saved<span class="op">.</span><span class="at">id</span><span class="op">,</span> saved<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">ttl</span>)<span class="op">;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> saved<span class="op">;</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">update</span>(id<span class="op">:</span> ID<span class="op">,</span> entity<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>T<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;</span> {</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> updated <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">update</span>(id<span class="op">,</span> entity)<span class="op">;</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">set</span>(id<span class="op">,</span> updated<span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="at">ttl</span>)<span class="op">;</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> updated<span class="op">;</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">delete</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">delete</span>(id)<span class="op">;</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">delete</span>(id)<span class="op">;</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">exists</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cached <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">cache</span><span class="op">.</span><span class="fu">get</span>(id)<span class="op">;</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cached <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">repository</span><span class="op">.</span><span class="fu">exists</span>(id)<span class="op">;</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co">// User Repository Implementation</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserRepository <span class="kw">implements</span> Repository<span class="op">&lt;</span>User<span class="op">,</span> UserId<span class="op">&gt;</span> {</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(<span class="kw">private</span> <span class="kw">readonly</span> db<span class="op">:</span> Database) {}</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findById</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span> {</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;SELECT * FROM users WHERE id = $1&#39;</span><span class="op">,</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>      [id]</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>] <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findAll</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User[]<span class="op">&gt;</span> {</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(<span class="st">&#39;SELECT * FROM users&#39;</span>)<span class="op">;</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span><span class="op">;</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">save</span>(user<span class="op">:</span> User)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User<span class="op">&gt;</span> {</span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`INSERT INTO users (email, first_name, last_name, display_name, avatar_url, </span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="vs">                         phone_number, date_of_birth, created_at, updated_at, </span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a><span class="vs">                         last_login_at, is_active, is_verified, preferences, metadata)</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="vs">       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14)</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="vs">       RETURNING *`</span><span class="op">,</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">email</span><span class="op">,</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">firstName</span><span class="op">,</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">lastName</span><span class="op">,</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">displayName</span><span class="op">,</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">avatarUrl</span><span class="op">,</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">phoneNumber</span><span class="op">,</span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">dateOfBirth</span><span class="op">,</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">createdAt</span><span class="op">,</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">updatedAt</span><span class="op">,</span></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">lastLoginAt</span><span class="op">,</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">isActive</span><span class="op">,</span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a>        user<span class="op">.</span><span class="at">isVerified</span><span class="op">,</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>        <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(user<span class="op">.</span><span class="at">preferences</span>)<span class="op">,</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a>        <span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(user<span class="op">.</span><span class="at">metadata</span>)</span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">update</span>(id<span class="op">:</span> UserId<span class="op">,</span> user<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>User<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User<span class="op">&gt;</span> {</span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> fields <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(user)<span class="op">.</span><span class="fu">filter</span>(key <span class="kw">=&gt;</span> key <span class="op">!==</span> <span class="st">&#39;id&#39;</span>)<span class="op">;</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> values <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(user)<span class="op">;</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> setClause <span class="op">=</span> fields<span class="op">.</span><span class="fu">map</span>((field<span class="op">,</span> index) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>field<span class="sc">}</span><span class="vs"> = $</span><span class="sc">${</span>index <span class="op">+</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">.</span><span class="fu">join</span>(<span class="st">&#39;, &#39;</span>)<span class="op">;</span></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`UPDATE users SET </span><span class="sc">${</span>setClause<span class="sc">}</span><span class="vs">, updated_at = NOW() </span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a><span class="vs">       WHERE id = $1 RETURNING *`</span><span class="op">,</span></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>      [id<span class="op">,</span> <span class="op">...</span>values]</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">delete</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(<span class="st">&#39;DELETE FROM users WHERE id = $1&#39;</span><span class="op">,</span> [id])<span class="op">;</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">exists</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;SELECT EXISTS(SELECT 1 FROM users WHERE id = $1)&#39;</span><span class="op">,</span></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>      [id]</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">exists</span><span class="op">;</span></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Custom queries</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findByEmail</span>(email<span class="op">:</span> Email)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User <span class="op">|</span> <span class="dt">null</span><span class="op">&gt;</span> {</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;SELECT * FROM users WHERE email = $1&#39;</span><span class="op">,</span></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>      [email<span class="op">.</span><span class="fu">toString</span>()]</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>] <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">findActiveUsers</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User[]<span class="op">&gt;</span> {</span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;SELECT * FROM users WHERE is_active = true&#39;</span></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">.</span><span class="at">rows</span><span class="op">;</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">updateLastLogin</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">db</span><span class="op">.</span><span class="fu">query</span>(</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;UPDATE users SET last_login_at = NOW() WHERE id = $1&#39;</span><span class="op">,</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true" tabindex="-1"></a>      [id]</span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="service-layer-avec-business-logic">7.3 Service Layer avec
Business Logic</h4>
<div class="sourceCode" id="cb16"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Service Interface</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> Service<span class="op">&lt;</span>T<span class="op">,</span> ID<span class="op">&gt;</span> {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getById</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getAll</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T[]<span class="op">&gt;;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create</span>(data<span class="op">:</span> CreateDto<span class="op">&lt;</span>T<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(id<span class="op">:</span> ID<span class="op">,</span> data<span class="op">:</span> UpdateDto<span class="op">&lt;</span>T<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>T<span class="op">&gt;;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">delete</span>(id<span class="op">:</span> ID)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">// User Service Implementation</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserService <span class="kw">implements</span> Service<span class="op">&lt;</span>User<span class="op">,</span> UserId<span class="op">&gt;</span> {</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> userRepository<span class="op">:</span> UserRepository<span class="op">,</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> eventBus<span class="op">:</span> EventBus<span class="op">,</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> passwordHasher<span class="op">:</span> PasswordHasher<span class="op">,</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> emailService<span class="op">:</span> EmailService<span class="op">,</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> validator<span class="op">:</span> Validator</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getById</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User<span class="op">&gt;</span> {</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(id)<span class="op">;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">UserNotFoundError</span>(id)<span class="op">;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user<span class="op">;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">getAll</span>()<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User[]<span class="op">&gt;</span> {</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findAll</span>()<span class="op">;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">create</span>(data<span class="op">:</span> CreateUserDto)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User<span class="op">&gt;</span> {</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validate input</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">validator</span><span class="op">.</span><span class="fu">validate</span>(data)<span class="op">;</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if email already exists</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findByEmail</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (existingUser) {</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">EmailAlreadyExistsError</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Hash password</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hashedPassword <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">passwordHasher</span><span class="op">.</span><span class="fu">hash</span>(data<span class="op">.</span><span class="at">password</span>)<span class="op">;</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create user</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user<span class="op">:</span> User <span class="op">=</span> {</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateId</span>()<span class="op">,</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> Email<span class="op">.</span><span class="fu">create</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">,</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>      firstName<span class="op">:</span> data<span class="op">.</span><span class="at">firstName</span><span class="op">,</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>      lastName<span class="op">:</span> data<span class="op">.</span><span class="at">lastName</span><span class="op">,</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>      displayName<span class="op">:</span> data<span class="op">.</span><span class="at">displayName</span><span class="op">,</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>      avatarUrl<span class="op">:</span> data<span class="op">.</span><span class="at">avatarUrl</span><span class="op">,</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>      phoneNumber<span class="op">:</span> data<span class="op">.</span><span class="at">phoneNumber</span><span class="op">,</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>      dateOfBirth<span class="op">:</span> data<span class="op">.</span><span class="at">dateOfBirth</span><span class="op">,</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>      createdAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>      isActive<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>      isVerified<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>      preferences<span class="op">:</span> {</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>        language<span class="op">:</span> <span class="st">&#39;fr&#39;</span><span class="op">,</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>        timezone<span class="op">:</span> <span class="st">&#39;Europe/Paris&#39;</span><span class="op">,</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>        currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span><span class="op">,</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>        notifications<span class="op">:</span> {</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>          email<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>          push<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>          sms<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>        privacy<span class="op">:</span> {</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>          profileVisibility<span class="op">:</span> <span class="st">&#39;friends&#39;</span><span class="op">,</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>          showEmail<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>          showPhone<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>        theme<span class="op">:</span> <span class="st">&#39;auto&#39;</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Save to repository</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> savedUser <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">save</span>(user)<span class="op">;</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.created&#39;</span><span class="op">,</span> {</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> savedUser<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> savedUser<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send welcome email</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">emailService</span><span class="op">.</span><span class="fu">sendWelcomeEmail</span>(savedUser<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> savedUser<span class="op">;</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">update</span>(id<span class="op">:</span> UserId<span class="op">,</span> data<span class="op">:</span> UpdateUserDto)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>User<span class="op">&gt;</span> {</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validate input</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">validator</span><span class="op">.</span><span class="fu">validate</span>(data)<span class="op">;</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get existing user</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getById</span>(id)<span class="op">;</span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check email uniqueness if email is being updated</span></span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (data<span class="op">.</span><span class="at">email</span> <span class="op">&amp;&amp;</span> data<span class="op">.</span><span class="at">email</span> <span class="op">!==</span> existingUser<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()) {</span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> userWithEmail <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findByEmail</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (userWithEmail) {</span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">EmailAlreadyExistsError</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update user</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> updatedUser <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(id<span class="op">,</span> {</span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.updated&#39;</span><span class="op">,</span> {</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> id<span class="op">,</span></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>      changes<span class="op">:</span> data<span class="op">,</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> updatedUser<span class="op">;</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">delete</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getById</span>(id)<span class="op">;</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Soft delete</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(id<span class="op">,</span> {</span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>      isActive<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish event</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.deleted&#39;</span><span class="op">,</span> {</span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> id<span class="op">,</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Business logic methods</span></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">updateLastLogin</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">updateLastLogin</span>(id)<span class="op">;</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.logged_in&#39;</span><span class="op">,</span> {</span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> id<span class="op">,</span></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">verifyEmail</span>(id<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(id<span class="op">,</span> {</span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a>      isVerified<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;user.verified&#39;</span><span class="op">,</span> {</span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> id<span class="op">,</span></span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">resetPassword</span>(email<span class="op">:</span> Email)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findByEmail</span>(email)<span class="op">;</span></span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Don&#39;t reveal if user exists</span></span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> resetToken <span class="op">=</span> <span class="fu">generateResetToken</span>()<span class="op">;</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(user<span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a>      resetToken<span class="op">,</span></span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a>      resetTokenExpiresAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">3600000</span>) <span class="co">// 1 hour</span></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-176"><a href="#cb16-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">emailService</span><span class="op">.</span><span class="fu">sendPasswordResetEmail</span>(email<span class="op">,</span> resetToken)<span class="op">;</span></span>
<span id="cb16-177"><a href="#cb16-177" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-178"><a href="#cb16-178" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="factory-pattern-pour-la-création-dentités">7.4 Factory Pattern
pour la création d’entités</h4>
<div class="sourceCode" id="cb17"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Entity Factory Interface</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> EntityFactory<span class="op">&lt;</span>T<span class="op">,</span> D<span class="op">&gt;</span> {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create</span>(data<span class="op">:</span> D)<span class="op">:</span> T<span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">createFromExisting</span>(entity<span class="op">:</span> T<span class="op">,</span> data<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>D<span class="op">&gt;</span>)<span class="op">:</span> T<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">// User Factory Implementation</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserFactory <span class="kw">implements</span> EntityFactory<span class="op">&lt;</span>User<span class="op">,</span> CreateUserDto<span class="op">&gt;</span> {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create</span>(data<span class="op">:</span> CreateUserDto)<span class="op">:</span> User {</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateId</span>()<span class="op">,</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> Email<span class="op">.</span><span class="fu">create</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      firstName<span class="op">:</span> data<span class="op">.</span><span class="at">firstName</span><span class="op">,</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      lastName<span class="op">:</span> data<span class="op">.</span><span class="at">lastName</span><span class="op">,</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      displayName<span class="op">:</span> data<span class="op">.</span><span class="at">displayName</span><span class="op">,</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      avatarUrl<span class="op">:</span> data<span class="op">.</span><span class="at">avatarUrl</span><span class="op">,</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      phoneNumber<span class="op">:</span> data<span class="op">.</span><span class="at">phoneNumber</span><span class="op">,</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>      dateOfBirth<span class="op">:</span> data<span class="op">.</span><span class="at">dateOfBirth</span><span class="op">,</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>      createdAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>      isActive<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      isVerified<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>      preferences<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createDefaultPreferences</span>()<span class="op">,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">createFromExisting</span>(user<span class="op">:</span> User<span class="op">,</span> data<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>CreateUserDto<span class="op">&gt;</span>)<span class="op">:</span> User {</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>user<span class="op">,</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">createDefaultPreferences</span>()<span class="op">:</span> UserPreferences {</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>      language<span class="op">:</span> <span class="st">&#39;fr&#39;</span><span class="op">,</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>      timezone<span class="op">:</span> <span class="st">&#39;Europe/Paris&#39;</span><span class="op">,</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>      currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span><span class="op">,</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>      notifications<span class="op">:</span> {</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        push<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>        sms<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>      privacy<span class="op">:</span> {</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        profileVisibility<span class="op">:</span> <span class="st">&#39;friends&#39;</span><span class="op">,</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>        showEmail<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>        showPhone<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>      theme<span class="op">:</span> <span class="st">&#39;auto&#39;</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co">// Event Factory Implementation</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EventFactory <span class="kw">implements</span> EntityFactory<span class="op">&lt;</span><span class="bu">Event</span><span class="op">,</span> CreateEventDto<span class="op">&gt;</span> {</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create</span>(data<span class="op">:</span> CreateEventDto)<span class="op">:</span> <span class="bu">Event</span> {</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateId</span>()<span class="op">,</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> data<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> data<span class="op">.</span><span class="at">description</span><span class="op">,</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>      groupId<span class="op">:</span> data<span class="op">.</span><span class="at">groupId</span><span class="op">,</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>      createdBy<span class="op">:</span> data<span class="op">.</span><span class="at">createdBy</span><span class="op">,</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>      startDate<span class="op">:</span> data<span class="op">.</span><span class="at">startDate</span><span class="op">,</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>      endDate<span class="op">:</span> data<span class="op">.</span><span class="at">endDate</span><span class="op">,</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>      location<span class="op">:</span> data<span class="op">.</span><span class="at">location</span><span class="op">,</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>      locationCoordinates<span class="op">:</span> data<span class="op">.</span><span class="at">locationCoordinates</span><span class="op">,</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>      status<span class="op">:</span> EventStatus<span class="op">.</span><span class="at">PLANNING</span><span class="op">,</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>      attendees<span class="op">:</span> [data<span class="op">.</span><span class="at">createdBy</span>]<span class="op">,</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>      maxParticipants<span class="op">:</span> data<span class="op">.</span><span class="at">maxParticipants</span><span class="op">,</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>      isPublic<span class="op">:</span> data<span class="op">.</span><span class="at">isPublic</span> <span class="op">||</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>      aiGenerated<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>      plan<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">createEmptyPlan</span>()<span class="op">,</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>      createdAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">createFromExisting</span>(event<span class="op">:</span> <span class="bu">Event</span><span class="op">,</span> data<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>CreateEventDto<span class="op">&gt;</span>)<span class="op">:</span> <span class="bu">Event</span> {</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span><span class="bu">event</span><span class="op">,</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>      updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">createEmptyPlan</span>()<span class="op">:</span> EventPlan {</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>      activities<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>      timeline<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>      budget<span class="op">:</span> {</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>        total<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>        perPerson<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>        breakdown<span class="op">:</span> {</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>          accommodation<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>          transport<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>          food<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>          entertainment<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>          other<span class="op">:</span> <span class="dv">0</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>      recommendations<span class="op">:</span> []</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="sécurité-et-conformité">8. SÉCURITÉ ET CONFORMITÉ</h3>
<h4 id="architecture-de-sécurité-multi-couches">8.1 Architecture de
sécurité multi-couches</h4>
<div class="sourceCode" id="cb18"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Security Layer Architecture</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SecurityLayer {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  authentication<span class="op">:</span> AuthenticationService<span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  authorization<span class="op">:</span> AuthorizationService<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  encryption<span class="op">:</span> EncryptionService<span class="op">;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  audit<span class="op">:</span> AuditService<span class="op">;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  compliance<span class="op">:</span> ComplianceService<span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Authentication Service</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuthenticationService {</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> userRepository<span class="op">:</span> UserRepository<span class="op">,</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> passwordHasher<span class="op">:</span> PasswordHasher<span class="op">,</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> jwtService<span class="op">:</span> JwtService<span class="op">,</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> rateLimiter<span class="op">:</span> RateLimiter<span class="op">,</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> auditService<span class="op">:</span> AuditService</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">login</span>(email<span class="op">:</span> Email<span class="op">,</span> password<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> deviceInfo<span class="op">:</span> DeviceInfo)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>AuthResult<span class="op">&gt;</span> {</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Rate limiting</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">rateLimiter</span><span class="op">.</span><span class="fu">checkLimit</span>(<span class="vs">`login:</span><span class="sc">${</span>email<span class="op">.</span><span class="fu">toString</span>()<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">300000</span>)<span class="op">;</span> <span class="co">// 5 attempts per 5 minutes</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find user</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findByEmail</span>(email)<span class="op">;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logFailedLogin</span>(email<span class="op">,</span> <span class="st">&#39;User not found&#39;</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">AuthenticationError</span>(<span class="st">&#39;Invalid credentials&#39;</span>)<span class="op">;</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if account is locked</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (user<span class="op">.</span><span class="at">security</span><span class="op">.</span><span class="at">lockedUntil</span> <span class="op">&amp;&amp;</span> user<span class="op">.</span><span class="at">security</span><span class="op">.</span><span class="at">lockedUntil</span> <span class="op">&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>()) {</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logFailedLogin</span>(email<span class="op">,</span> <span class="st">&#39;Account locked&#39;</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">AccountLockedError</span>(user<span class="op">.</span><span class="at">security</span><span class="op">.</span><span class="at">lockedUntil</span>)<span class="op">;</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Verify password</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isValid <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">passwordHasher</span><span class="op">.</span><span class="fu">verify</span>(password<span class="op">,</span> user<span class="op">.</span><span class="at">passwordHash</span>)<span class="op">;</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>isValid) {</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">handleFailedLogin</span>(user)<span class="op">;</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">AuthenticationError</span>(<span class="st">&#39;Invalid credentials&#39;</span>)<span class="op">;</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if account is active</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user<span class="op">.</span><span class="at">isActive</span>) {</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logFailedLogin</span>(email<span class="op">,</span> <span class="st">&#39;Account inactive&#39;</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">AccountInactiveError</span>()<span class="op">;</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate JWT token</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> token <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">generateToken</span>({</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>      roles<span class="op">:</span> user<span class="op">.</span><span class="at">roles</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update last login</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">updateLastLogin</span>(user<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Reset failed login attempts</span></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(user<span class="op">.</span><span class="at">id</span><span class="op">,</span> {</span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>      security<span class="op">:</span> {</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>user<span class="op">.</span><span class="at">security</span><span class="op">,</span></span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>        failedLoginAttempts<span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>        lockedUntil<span class="op">:</span> <span class="dt">null</span></span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log successful login</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logSuccessfulLogin</span>(user<span class="op">.</span><span class="at">id</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>      token<span class="op">,</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>      user<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">sanitizeUser</span>(user)<span class="op">,</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>      expiresAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">3600000</span>) <span class="co">// 1 hour</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">register</span>(data<span class="op">:</span> RegisterDto<span class="op">,</span> deviceInfo<span class="op">:</span> DeviceInfo)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>AuthResult<span class="op">&gt;</span> {</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Validate input</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">validateRegistrationData</span>(data)<span class="op">;</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if email exists</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> existingUser <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findByEmail</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (existingUser) {</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">EmailAlreadyExistsError</span>(data<span class="op">.</span><span class="at">email</span>)<span class="op">;</span></span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Hash password</span></span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> passwordHash <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">passwordHasher</span><span class="op">.</span><span class="fu">hash</span>(data<span class="op">.</span><span class="at">password</span>)<span class="op">;</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create user</span></span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userService</span><span class="op">.</span><span class="fu">create</span>({</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>data<span class="op">,</span></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>      passwordHash</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate verification token</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verificationToken <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">generateVerificationToken</span>(user<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Send verification email</span></span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">emailService</span><span class="op">.</span><span class="fu">sendVerificationEmail</span>(user<span class="op">.</span><span class="at">email</span><span class="op">,</span> verificationToken)<span class="op">;</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log registration</span></span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logRegistration</span>(user<span class="op">.</span><span class="at">id</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate session token</span></span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> token <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">generateToken</span>({</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>      roles<span class="op">:</span> user<span class="op">.</span><span class="at">roles</span></span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>      token<span class="op">,</span></span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>      user<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">sanitizeUser</span>(user)<span class="op">,</span></span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>      expiresAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">3600000</span>)</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">refreshToken</span>(refreshToken<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>AuthResult<span class="op">&gt;</span> {</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> payload <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">verifyRefreshToken</span>(refreshToken)<span class="op">;</span></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(payload<span class="op">.</span><span class="at">userId</span>)<span class="op">;</span></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user <span class="op">||</span> <span class="op">!</span>user<span class="op">.</span><span class="at">isActive</span>) {</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">AuthenticationError</span>(<span class="st">&#39;Invalid refresh token&#39;</span>)<span class="op">;</span></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newToken <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">generateToken</span>({</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>      roles<span class="op">:</span> user<span class="op">.</span><span class="at">roles</span></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>      token<span class="op">:</span> newToken<span class="op">,</span></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>      user<span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="fu">sanitizeUser</span>(user)<span class="op">,</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>      expiresAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">3600000</span>)</span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logout</span>(token<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> deviceInfo<span class="op">:</span> DeviceInfo)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> payload <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">verifyToken</span>(token)<span class="op">;</span></span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">jwtService</span><span class="op">.</span><span class="fu">blacklistToken</span>(token)<span class="op">;</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logLogout</span>(payload<span class="op">.</span><span class="at">userId</span><span class="op">,</span> deviceInfo)<span class="op">;</span></span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">handleFailedLogin</span>(user<span class="op">:</span> User)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newAttempts <span class="op">=</span> user<span class="op">.</span><span class="at">security</span><span class="op">.</span><span class="at">failedLoginAttempts</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> updates<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>User<span class="op">&gt;</span> <span class="op">=</span> {</span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>      security<span class="op">:</span> {</span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span>user<span class="op">.</span><span class="at">security</span><span class="op">,</span></span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>        failedLoginAttempts<span class="op">:</span> newAttempts</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Lock account after 5 failed attempts</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (newAttempts <span class="op">&gt;=</span> <span class="dv">5</span>) {</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>      updates<span class="op">.</span><span class="at">security</span><span class="op">.</span><span class="at">lockedUntil</span> <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> <span class="dv">900000</span>)<span class="op">;</span> <span class="co">// 15 minutes</span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(user<span class="op">.</span><span class="at">id</span><span class="op">,</span> updates)<span class="op">;</span></span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="fu">sanitizeUser</span>(user<span class="op">:</span> User)<span class="op">:</span> SanitizedUser {</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>      firstName<span class="op">:</span> user<span class="op">.</span><span class="at">firstName</span><span class="op">,</span></span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>      lastName<span class="op">:</span> user<span class="op">.</span><span class="at">lastName</span><span class="op">,</span></span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>      displayName<span class="op">:</span> user<span class="op">.</span><span class="at">displayName</span><span class="op">,</span></span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>      avatarUrl<span class="op">:</span> user<span class="op">.</span><span class="at">avatarUrl</span><span class="op">,</span></span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a>      isVerified<span class="op">:</span> user<span class="op">.</span><span class="at">isVerified</span><span class="op">,</span></span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a>      preferences<span class="op">:</span> user<span class="op">.</span><span class="at">preferences</span></span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a><span class="co">// Authorization Service</span></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuthorizationService {</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> roleRepository<span class="op">:</span> RoleRepository<span class="op">,</span></span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> permissionRepository<span class="op">:</span> PermissionRepository</span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">hasPermission</span>(userId<span class="op">:</span> UserId<span class="op">,</span> resource<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> action<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(userId)<span class="op">;</span></span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> roles <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">roleRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> permissions <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">permissionRepository</span><span class="op">.</span><span class="fu">findByRoles</span>(roles<span class="op">.</span><span class="fu">map</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">id</span>))<span class="op">;</span></span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> permissions<span class="op">.</span><span class="fu">some</span>(p <span class="kw">=&gt;</span> </span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a>      p<span class="op">.</span><span class="at">resource</span> <span class="op">===</span> resource <span class="op">&amp;&amp;</span> p<span class="op">.</span><span class="at">action</span> <span class="op">===</span> action</span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">hasRole</span>(userId<span class="op">:</span> UserId<span class="op">,</span> role<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(userId)<span class="op">;</span></span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> roles <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">roleRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> roles<span class="op">.</span><span class="fu">some</span>(r <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">name</span> <span class="op">===</span> role)<span class="op">;</span></span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">canAccessEvent</span>(userId<span class="op">:</span> UserId<span class="op">,</span> eventId<span class="op">:</span> EventId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> <span class="bu">event</span> <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventRepository</span><span class="op">.</span><span class="fu">findById</span>(eventId)<span class="op">;</span></span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span>) {</span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Event creator can always access</span></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">createdBy</span> <span class="op">===</span> userId) {</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if user is a participant</span></span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> participant <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventParticipantRepository</span><span class="op">.</span><span class="fu">findByEventAndUser</span>(eventId<span class="op">,</span> userId)<span class="op">;</span></span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (participant) {</span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if user is admin of the group</span></span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> groupMember <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">groupMemberRepository</span><span class="op">.</span><span class="fu">findByGroupAndUser</span>(<span class="bu">event</span><span class="op">.</span><span class="at">groupId</span><span class="op">,</span> userId)<span class="op">;</span></span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (groupMember <span class="op">&amp;&amp;</span> groupMember<span class="op">.</span><span class="at">role</span> <span class="op">===</span> UserRole<span class="op">.</span><span class="at">ADMIN</span>) {</span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">canModifyEvent</span>(userId<span class="op">:</span> UserId<span class="op">,</span> eventId<span class="op">:</span> EventId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> <span class="bu">event</span> <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventRepository</span><span class="op">.</span><span class="fu">findById</span>(eventId)<span class="op">;</span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span>) {</span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Only event creator can modify</span></span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">event</span><span class="op">.</span><span class="at">createdBy</span> <span class="op">===</span> userId<span class="op">;</span></span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">canAccessExpense</span>(userId<span class="op">:</span> UserId<span class="op">,</span> expenseId<span class="op">:</span> ExpenseId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> expense <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">expenseRepository</span><span class="op">.</span><span class="fu">findById</span>(expenseId)<span class="op">;</span></span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>expense) {</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Expense creator can always access</span></span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (expense<span class="op">.</span><span class="at">createdBy</span> <span class="op">===</span> userId) {</span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if user is a participant</span></span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> participant <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">expenseParticipantRepository</span><span class="op">.</span><span class="fu">findByExpenseAndUser</span>(expenseId<span class="op">,</span> userId)<span class="op">;</span></span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (participant) {</span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a><span class="co">// Encryption Service</span></span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EncryptionService {</span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> algorithm<span class="op">:</span> <span class="dt">string</span> <span class="op">=</span> <span class="st">&#39;aes-256-gcm&#39;</span><span class="op">,</span></span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> keyLength<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">32</span><span class="op">,</span></span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> ivLength<span class="op">:</span> <span class="dt">number</span> <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">encrypt</span>(data<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> key<span class="op">:</span> <span class="bu">Buffer</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>EncryptedData<span class="op">&gt;</span> {</span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> iv <span class="op">=</span> crypto<span class="op">.</span><span class="fu">randomBytes</span>(<span class="kw">this</span><span class="op">.</span><span class="at">ivLength</span>)<span class="op">;</span></span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cipher <span class="op">=</span> crypto<span class="op">.</span><span class="fu">createCipher</span>(<span class="kw">this</span><span class="op">.</span><span class="at">algorithm</span><span class="op">,</span> key)<span class="op">;</span></span>
<span id="cb18-278"><a href="#cb18-278" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-279"><a href="#cb18-279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> encrypted <span class="op">=</span> cipher<span class="op">.</span><span class="fu">update</span>(data<span class="op">,</span> <span class="st">&#39;utf8&#39;</span><span class="op">,</span> <span class="st">&#39;hex&#39;</span>)<span class="op">;</span></span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a>    encrypted <span class="op">+=</span> cipher<span class="op">.</span><span class="fu">final</span>(<span class="st">&#39;hex&#39;</span>)<span class="op">;</span></span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> authTag <span class="op">=</span> cipher<span class="op">.</span><span class="fu">getAuthTag</span>()<span class="op">;</span></span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a>      encrypted<span class="op">,</span></span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a>      iv<span class="op">:</span> iv<span class="op">.</span><span class="fu">toString</span>(<span class="st">&#39;hex&#39;</span>)<span class="op">,</span></span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a>      authTag<span class="op">:</span> authTag<span class="op">.</span><span class="fu">toString</span>(<span class="st">&#39;hex&#39;</span>)</span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">decrypt</span>(encryptedData<span class="op">:</span> EncryptedData<span class="op">,</span> key<span class="op">:</span> <span class="bu">Buffer</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> {</span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> decipher <span class="op">=</span> crypto<span class="op">.</span><span class="fu">createDecipher</span>(</span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a>      <span class="kw">this</span><span class="op">.</span><span class="at">algorithm</span><span class="op">,</span></span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a>      key<span class="op">,</span></span>
<span id="cb18-295"><a href="#cb18-295" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Buffer</span><span class="op">.</span><span class="fu">from</span>(encryptedData<span class="op">.</span><span class="at">iv</span><span class="op">,</span> <span class="st">&#39;hex&#39;</span>)</span>
<span id="cb18-296"><a href="#cb18-296" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a>    decipher<span class="op">.</span><span class="fu">setAuthTag</span>(<span class="bu">Buffer</span><span class="op">.</span><span class="fu">from</span>(encryptedData<span class="op">.</span><span class="at">authTag</span><span class="op">,</span> <span class="st">&#39;hex&#39;</span>))<span class="op">;</span></span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> decrypted <span class="op">=</span> decipher<span class="op">.</span><span class="fu">update</span>(encryptedData<span class="op">.</span><span class="at">encrypted</span><span class="op">,</span> <span class="st">&#39;hex&#39;</span><span class="op">,</span> <span class="st">&#39;utf8&#39;</span>)<span class="op">;</span></span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a>    decrypted <span class="op">+=</span> decipher<span class="op">.</span><span class="fu">final</span>(<span class="st">&#39;utf8&#39;</span>)<span class="op">;</span></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decrypted<span class="op">;</span></span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">hashPassword</span>(password<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">string</span><span class="op">&gt;</span> {</span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> saltRounds <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">hash</span>(password<span class="op">,</span> saltRounds)<span class="op">;</span></span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">verifyPassword</span>(password<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> hash<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">boolean</span><span class="op">&gt;</span> {</span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> bcrypt<span class="op">.</span><span class="fu">compare</span>(password<span class="op">,</span> hash)<span class="op">;</span></span>
<span id="cb18-313"><a href="#cb18-313" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-314"><a href="#cb18-314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generateSecureToken</span>()<span class="op">:</span> <span class="dt">string</span> {</span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> crypto<span class="op">.</span><span class="fu">randomBytes</span>(<span class="dv">32</span>)<span class="op">.</span><span class="fu">toString</span>(<span class="st">&#39;hex&#39;</span>)<span class="op">;</span></span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a><span class="co">// Audit Service</span></span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> AuditService {</span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> auditRepository<span class="op">:</span> AuditRepository<span class="op">,</span></span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> eventBus<span class="op">:</span> EventBus</span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logAction</span>(action<span class="op">:</span> AuditAction)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> auditEntry<span class="op">:</span> AuditEntry <span class="op">=</span> {</span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a>      id<span class="op">:</span> <span class="fu">generateId</span>()<span class="op">,</span></span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">:</span> action<span class="op">.</span><span class="at">userId</span><span class="op">,</span></span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a>      action<span class="op">:</span> action<span class="op">.</span><span class="at">type</span><span class="op">,</span></span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">:</span> action<span class="op">.</span><span class="at">resource</span><span class="op">,</span></span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">:</span> action<span class="op">.</span><span class="at">resourceId</span><span class="op">,</span></span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> action<span class="op">.</span><span class="at">details</span><span class="op">,</span></span>
<span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> action<span class="op">.</span><span class="at">ipAddress</span><span class="op">,</span></span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> action<span class="op">.</span><span class="at">userAgent</span><span class="op">,</span></span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a>      timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> action<span class="op">.</span><span class="at">metadata</span></span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditRepository</span><span class="op">.</span><span class="fu">save</span>(auditEntry)<span class="op">;</span></span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Publish audit event</span></span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventBus</span><span class="op">.</span><span class="fu">publish</span>(<span class="st">&#39;audit.action&#39;</span><span class="op">,</span> auditEntry)<span class="op">;</span></span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logLogin</span>(userId<span class="op">:</span> UserId<span class="op">,</span> success<span class="op">:</span> <span class="dt">boolean</span><span class="op">,</span> deviceInfo<span class="op">:</span> DeviceInfo)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> success <span class="op">?</span> <span class="st">&#39;LOGIN_SUCCESS&#39;</span> <span class="op">:</span> <span class="st">&#39;LOGIN_FAILURE&#39;</span><span class="op">,</span></span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">:</span> <span class="st">&#39;auth&#39;</span><span class="op">,</span></span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">:</span> userId<span class="op">,</span></span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a>        success<span class="op">,</span></span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a>        deviceInfo</span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> deviceInfo<span class="op">.</span><span class="at">ipAddress</span><span class="op">,</span></span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> deviceInfo<span class="op">.</span><span class="at">userAgent</span><span class="op">,</span></span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {</span>
<span id="cb18-360"><a href="#cb18-360" aria-hidden="true" tabindex="-1"></a>        deviceType<span class="op">:</span> deviceInfo<span class="op">.</span><span class="at">deviceType</span><span class="op">,</span></span>
<span id="cb18-361"><a href="#cb18-361" aria-hidden="true" tabindex="-1"></a>        location<span class="op">:</span> deviceInfo<span class="op">.</span><span class="at">location</span></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logDataAccess</span>(userId<span class="op">:</span> UserId<span class="op">,</span> resource<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> resourceId<span class="op">:</span> <span class="dt">string</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;DATA_ACCESS&#39;</span><span class="op">,</span></span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">,</span></span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">,</span></span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a>        accessType<span class="op">:</span> <span class="st">&#39;read&#39;</span></span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">logDataModification</span>(userId<span class="op">:</span> UserId<span class="op">,</span> resource<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> resourceId<span class="op">:</span> <span class="dt">string</span><span class="op">,</span> changes<span class="op">:</span> <span class="dt">any</span>)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb18-383"><a href="#cb18-383" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;DATA_MODIFICATION&#39;</span><span class="op">,</span></span>
<span id="cb18-384"><a href="#cb18-384" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">,</span></span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">,</span></span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a>        changes<span class="op">,</span></span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a>        modificationType<span class="op">:</span> <span class="st">&#39;update&#39;</span></span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h4 id="conformité-rgpdgdpr">8.2 Conformité RGPD/GDPR</h4>
<div class="sourceCode" id="cb19"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// GDPR Compliance Service</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> GDPRComplianceService {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> userRepository<span class="op">:</span> UserRepository<span class="op">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> dataProcessor<span class="op">:</span> DataProcessor<span class="op">,</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> auditService<span class="op">:</span> AuditService</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  ) {}</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">exportUserData</span>(userId<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>UserDataExport<span class="op">&gt;</span> {</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(userId)<span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">UserNotFoundError</span>(userId)<span class="op">;</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Collect all user data</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> userData <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">collectUserData</span>(userId)<span class="op">;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log data export</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;DATA_EXPORT&#39;</span><span class="op">,</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">:</span> <span class="st">&#39;user&#39;</span><span class="op">,</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">:</span> userId<span class="op">,</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        exportType<span class="op">:</span> <span class="st">&#39;gdpr&#39;</span><span class="op">,</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        dataTypes<span class="op">:</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(userData)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>      exportedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>      data<span class="op">:</span> userData<span class="op">,</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>      format<span class="op">:</span> <span class="st">&#39;json&#39;</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">deleteUserData</span>(userId<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(userId)<span class="op">;</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>user) {</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="fu">UserNotFoundError</span>(userId)<span class="op">;</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Anonymize user data</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="fu">anonymizeUserData</span>(userId)<span class="op">;</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Log data deletion</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;DATA_DELETION&#39;</span><span class="op">,</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">:</span> <span class="st">&#39;user&#39;</span><span class="op">,</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">:</span> userId<span class="op">,</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        deletionType<span class="op">:</span> <span class="st">&#39;gdpr_right_to_be_forgotten&#39;</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">updateConsent</span>(userId<span class="op">:</span> UserId<span class="op">,</span> consent<span class="op">:</span> ConsentSettings)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(userId<span class="op">,</span> {</span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>      consent<span class="op">:</span> {</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>        marketing<span class="op">:</span> consent<span class="op">.</span><span class="at">marketing</span><span class="op">,</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        analytics<span class="op">:</span> consent<span class="op">.</span><span class="at">analytics</span><span class="op">,</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>        thirdParty<span class="op">:</span> consent<span class="op">.</span><span class="at">thirdParty</span><span class="op">,</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>        updatedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">auditService</span><span class="op">.</span><span class="fu">logAction</span>({</span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>      type<span class="op">:</span> <span class="st">&#39;CONSENT_UPDATE&#39;</span><span class="op">,</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>      userId<span class="op">,</span></span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>      resource<span class="op">:</span> <span class="st">&#39;user&#39;</span><span class="op">,</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>      resourceId<span class="op">:</span> userId<span class="op">,</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>      details<span class="op">:</span> {</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>        consent</span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>      ipAddress<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>      userAgent<span class="op">:</span> <span class="st">&#39;unknown&#39;</span><span class="op">,</span></span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {}</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">collectUserData</span>(userId<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span>UserDataExport<span class="op">&gt;</span> {</span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> user <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">findById</span>(userId)<span class="op">;</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> groups <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">groupRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> events <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">eventRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> expenses <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">expenseRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> notifications <span class="op">=</span> <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">notificationRepository</span><span class="op">.</span><span class="fu">findByUserId</span>(userId)<span class="op">;</span></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>      profile<span class="op">:</span> {</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> user<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> user<span class="op">.</span><span class="at">email</span><span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>        firstName<span class="op">:</span> user<span class="op">.</span><span class="at">firstName</span><span class="op">,</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>        lastName<span class="op">:</span> user<span class="op">.</span><span class="at">lastName</span><span class="op">,</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>        displayName<span class="op">:</span> user<span class="op">.</span><span class="at">displayName</span><span class="op">,</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>        avatarUrl<span class="op">:</span> user<span class="op">.</span><span class="at">avatarUrl</span><span class="op">,</span></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>        phoneNumber<span class="op">:</span> user<span class="op">.</span><span class="at">phoneNumber</span><span class="op">,</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>        dateOfBirth<span class="op">:</span> user<span class="op">.</span><span class="at">dateOfBirth</span><span class="op">,</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>        createdAt<span class="op">:</span> user<span class="op">.</span><span class="at">createdAt</span><span class="op">,</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>        lastLoginAt<span class="op">:</span> user<span class="op">.</span><span class="at">lastLoginAt</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>      preferences<span class="op">:</span> user<span class="op">.</span><span class="at">preferences</span><span class="op">,</span></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>      groups<span class="op">:</span> groups<span class="op">.</span><span class="fu">map</span>(g <span class="kw">=&gt;</span> ({</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> g<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>        name<span class="op">:</span> g<span class="op">.</span><span class="at">name</span><span class="op">,</span></span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>        role<span class="op">:</span> g<span class="op">.</span><span class="at">role</span><span class="op">,</span></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>        joinedAt<span class="op">:</span> g<span class="op">.</span><span class="at">joinedAt</span></span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">,</span></span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>      events<span class="op">:</span> events<span class="op">.</span><span class="fu">map</span>(e <span class="kw">=&gt;</span> ({</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> e<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>        title<span class="op">:</span> e<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>        startDate<span class="op">:</span> e<span class="op">.</span><span class="at">startDate</span><span class="op">,</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>        status<span class="op">:</span> e<span class="op">.</span><span class="at">status</span></span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">,</span></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>      expenses<span class="op">:</span> expenses<span class="op">.</span><span class="fu">map</span>(ex <span class="kw">=&gt;</span> ({</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> ex<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>        title<span class="op">:</span> ex<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>        amount<span class="op">:</span> ex<span class="op">.</span><span class="at">amount</span><span class="op">,</span></span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>        category<span class="op">:</span> ex<span class="op">.</span><span class="at">category</span><span class="op">,</span></span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>        date<span class="op">:</span> ex<span class="op">.</span><span class="at">date</span></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">,</span></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>      notifications<span class="op">:</span> notifications<span class="op">.</span><span class="fu">map</span>(n <span class="kw">=&gt;</span> ({</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>        id<span class="op">:</span> n<span class="op">.</span><span class="at">id</span><span class="op">,</span></span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>        type<span class="op">:</span> n<span class="op">.</span><span class="at">type</span><span class="op">,</span></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>        title<span class="op">:</span> n<span class="op">.</span><span class="at">title</span><span class="op">,</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>        createdAt<span class="op">:</span> n<span class="op">.</span><span class="at">createdAt</span></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>  <span class="kw">private</span> <span class="kw">async</span> <span class="fu">anonymizeUserData</span>(userId<span class="op">:</span> UserId)<span class="op">:</span> <span class="bu">Promise</span><span class="op">&lt;</span><span class="dt">void</span><span class="op">&gt;</span> {</span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> anonymizedData <span class="op">=</span> {</span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a>      email<span class="op">:</span> <span class="vs">`deleted_</span><span class="sc">${</span>userId<span class="sc">}</span><span class="vs">@deleted.com`</span><span class="op">,</span></span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>      firstName<span class="op">:</span> <span class="st">&#39;Deleted&#39;</span><span class="op">,</span></span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>      lastName<span class="op">:</span> <span class="st">&#39;User&#39;</span><span class="op">,</span></span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a>      displayName<span class="op">:</span> <span class="st">&#39;Deleted User&#39;</span><span class="op">,</span></span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a>      avatarUrl<span class="op">:</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>      phoneNumber<span class="op">:</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a>      dateOfBirth<span class="op">:</span> <span class="dt">null</span><span class="op">,</span></span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a>      isActive<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a>      isVerified<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a>      preferences<span class="op">:</span> {</span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a>        language<span class="op">:</span> <span class="st">&#39;en&#39;</span><span class="op">,</span></span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a>        timezone<span class="op">:</span> <span class="st">&#39;UTC&#39;</span><span class="op">,</span></span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a>        currency<span class="op">:</span> <span class="st">&#39;EUR&#39;</span><span class="op">,</span></span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a>        notifications<span class="op">:</span> {</span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a>          email<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a>          push<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>          sms<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>        privacy<span class="op">:</span> {</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a>          profileVisibility<span class="op">:</span> <span class="st">&#39;private&#39;</span><span class="op">,</span></span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a>          showEmail<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>          showPhone<span class="op">:</span> <span class="kw">false</span></span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>        theme<span class="op">:</span> <span class="st">&#39;light&#39;</span></span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a>      metadata<span class="op">:</span> {</span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a>        anonymizedAt<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">,</span></span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a>        reason<span class="op">:</span> <span class="st">&#39;gdpr_deletion&#39;</span></span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">this</span><span class="op">.</span><span class="at">userRepository</span><span class="op">.</span><span class="fu">update</span>(userId<span class="op">,</span> anonymizedData)<span class="op">;</span></span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a><span class="co">// Data Processing Agreement</span></span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DataProcessingAgreement {</span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a>  id<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a>  version<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-179"><a href="#cb19-179" aria-hidden="true" tabindex="-1"></a>  effectiveDate<span class="op">:</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb19-180"><a href="#cb19-180" aria-hidden="true" tabindex="-1"></a>  dataController<span class="op">:</span> {</span>
<span id="cb19-181"><a href="#cb19-181" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-182"><a href="#cb19-182" aria-hidden="true" tabindex="-1"></a>    address<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-183"><a href="#cb19-183" aria-hidden="true" tabindex="-1"></a>    contactEmail<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-184"><a href="#cb19-184" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb19-185"><a href="#cb19-185" aria-hidden="true" tabindex="-1"></a>  dataProcessor<span class="op">:</span> {</span>
<span id="cb19-186"><a href="#cb19-186" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-187"><a href="#cb19-187" aria-hidden="true" tabindex="-1"></a>    address<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-188"><a href="#cb19-188" aria-hidden="true" tabindex="-1"></a>    contactEmail<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-189"><a href="#cb19-189" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb19-190"><a href="#cb19-190" aria-hidden="true" tabindex="-1"></a>  purposes<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb19-191"><a href="#cb19-191" aria-hidden="true" tabindex="-1"></a>  dataTypes<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb19-192"><a href="#cb19-192" aria-hidden="true" tabindex="-1"></a>  dataSubjects<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb19-193"><a href="#cb19-193" aria-hidden="true" tabindex="-1"></a>  retentionPeriod<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-194"><a href="#cb19-194" aria-hidden="true" tabindex="-1"></a>  securityMeasures<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb19-195"><a href="#cb19-195" aria-hidden="true" tabindex="-1"></a>  subProcessors<span class="op">:</span> SubProcessor[]<span class="op">;</span></span>
<span id="cb19-196"><a href="#cb19-196" aria-hidden="true" tabindex="-1"></a>  rights<span class="op">:</span> DataSubjectRights<span class="op">;</span></span>
<span id="cb19-197"><a href="#cb19-197" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-198"><a href="#cb19-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-199"><a href="#cb19-199" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> SubProcessor {</span>
<span id="cb19-200"><a href="#cb19-200" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-201"><a href="#cb19-201" aria-hidden="true" tabindex="-1"></a>  purpose<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-202"><a href="#cb19-202" aria-hidden="true" tabindex="-1"></a>  location<span class="op">:</span> <span class="dt">string</span><span class="op">;</span></span>
<span id="cb19-203"><a href="#cb19-203" aria-hidden="true" tabindex="-1"></a>  dataTypes<span class="op">:</span> <span class="dt">string</span>[]<span class="op">;</span></span>
<span id="cb19-204"><a href="#cb19-204" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-205"><a href="#cb19-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-206"><a href="#cb19-206" aria-hidden="true" tabindex="-1"></a><span class="kw">interface</span> DataSubjectRights {</span>
<span id="cb19-207"><a href="#cb19-207" aria-hidden="true" tabindex="-1"></a>  access<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-208"><a href="#cb19-208" aria-hidden="true" tabindex="-1"></a>  rectification<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-209"><a href="#cb19-209" aria-hidden="true" tabindex="-1"></a>  erasure<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-210"><a href="#cb19-210" aria-hidden="true" tabindex="-1"></a>  portability<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-211"><a href="#cb19-211" aria-hidden="true" tabindex="-1"></a>  objection<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-212"><a href="#cb19-212" aria-hidden="true" tabindex="-1"></a>  restriction<span class="op">:</span> <span class="dt">boolean</span><span class="op">;</span></span>
<span id="cb19-213"><a href="#cb19-213" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<hr />
<p><em>[Suite dans la partie suivante…]</em></p>
<h1 id="rapport-technique-complexe---socialplanr-partie-4">RAPPORT
TECHNIQUE COMPLEXE - SOCIALPLANR (PARTIE 4)</h1>
<h2 id="développement-et-implémentation-avancée">Développement et
implémentation avancée</h2>
<hr />
<h2 id="partie-4-développement-et-implémentation">PARTIE 4 :
DÉVELOPPEMENT ET IMPLÉMENTATION</h2>
<h3 id="stack-technologique-détaillée">9. STACK TECHNOLOGIQUE
DÉTAILLÉE</h3>
<h4 id="architecture-frontend-mobile-react-native-expo">9.1 Architecture
Frontend Mobile (React Native + Expo)</h4>
<p><strong>Configuration Expo SDK 53 :</strong></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;expo&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;SocialPlanr&quot;</span><span class="fu">,</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;slug&quot;</span><span class="fu">:</span> <span class="st">&quot;socialplanr&quot;</span><span class="fu">,</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0&quot;</span><span class="fu">,</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;orientation&quot;</span><span class="fu">:</span> <span class="st">&quot;portrait&quot;</span><span class="fu">,</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;icon&quot;</span><span class="fu">:</span> <span class="st">&quot;./assets/icon.png&quot;</span><span class="fu">,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;userInterfaceStyle&quot;</span><span class="fu">:</span> <span class="st">&quot;automatic&quot;</span><span class="fu">,</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;splash&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;image&quot;</span><span class="fu">:</span> <span class="st">&quot;./assets/splash.png&quot;</span><span class="fu">,</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;resizeMode&quot;</span><span class="fu">:</span> <span class="st">&quot;contain&quot;</span><span class="fu">,</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;backgroundColor&quot;</span><span class="fu">:</span> <span class="st">&quot;#ffffff&quot;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;assetBundlePatterns&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;**/*&quot;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;ios&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;supportsTablet&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;bundleIdentifier&quot;</span><span class="fu">:</span> <span class="st">&quot;com.socialplanr.app&quot;</span><span class="fu">,</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;buildNumber&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0&quot;</span><span class="fu">,</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;infoPlist&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;NSCameraUsageDescription&quot;</span><span class="fu">:</span> <span class="st">&quot;Cette app utilise la caméra pour prendre des photos de profil&quot;</span><span class="fu">,</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;NSPhotoLibraryUsageDescription&quot;</span><span class="fu">:</span> <span class="st">&quot;Cette app accède à votre galerie pour sélectionner des photos&quot;</span><span class="fu">,</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;NSLocationWhenInUseUsageDescription&quot;</span><span class="fu">:</span> <span class="st">&quot;Cette app utilise votre localisation pour suggérer des lieux d&#39;événements&quot;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;android&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;adaptiveIcon&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;foregroundImage&quot;</span><span class="fu">:</span> <span class="st">&quot;./assets/adaptive-icon.png&quot;</span><span class="fu">,</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;backgroundColor&quot;</span><span class="fu">:</span> <span class="st">&quot;#FFFFFF&quot;</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;package&quot;</span><span class="fu">:</span> <span class="st">&quot;com.socialplanr.app&quot;</span><span class="fu">,</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;versionCode&quot;</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;permissions&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;CAMERA&quot;</span><span class="ot">,</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;READ_EXTERNAL_STORAGE&quot;</span><span class="ot">,</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;WRITE_EXTERNAL_STORAGE&quot;</span><span class="ot">,</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;ACCESS_FINE_LOCATION&quot;</span><span class="ot">,</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;ACCESS_COARSE_LOCATION&quot;</span><span class="ot">,</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;VIBRATE&quot;</span><span class="ot">,</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;RECEIVE_BOOT_COMPLETED&quot;</span><span class="ot">,</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;WAKE_LOCK&quot;</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;web&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;favicon&quot;</span><span class="fu">:</span> <span class="st">&quot;./assets/favicon.png&quot;</span><span class="fu">,</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;bundler&quot;</span><span class="fu">:</span> <span class="st">&quot;metro&quot;</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-router&quot;</span><span class="ot">,</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-font&quot;</span><span class="ot">,</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-splash-screen&quot;</span><span class="ot">,</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-status-bar&quot;</span><span class="ot">,</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-notifications&quot;</span><span class="ot">,</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-calendar&quot;</span><span class="ot">,</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-location&quot;</span><span class="ot">,</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-image-picker&quot;</span><span class="ot">,</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-camera&quot;</span><span class="ot">,</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-haptics&quot;</span><span class="ot">,</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-blur&quot;</span><span class="ot">,</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-linear-gradient&quot;</span><span class="ot">,</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-av&quot;</span><span class="ot">,</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-file-system&quot;</span><span class="ot">,</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-secure-store&quot;</span><span class="ot">,</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-device&quot;</span><span class="ot">,</span></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-constants&quot;</span><span class="ot">,</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-linking&quot;</span><span class="ot">,</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-web-browser&quot;</span><span class="ot">,</span></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-auth-session&quot;</span><span class="ot">,</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-crypto&quot;</span><span class="ot">,</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-random&quot;</span><span class="ot">,</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-sqlite&quot;</span><span class="ot">,</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-network&quot;</span><span class="ot">,</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-battery&quot;</span><span class="ot">,</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-brightness&quot;</span><span class="ot">,</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-sensors&quot;</span><span class="ot">,</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-task-manager&quot;</span><span class="ot">,</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-background-fetch&quot;</span><span class="ot">,</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-location&quot;</span><span class="ot">,</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-permissions&quot;</span><span class="ot">,</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-media-library&quot;</span><span class="ot">,</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-document-picker&quot;</span><span class="ot">,</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-sharing&quot;</span><span class="ot">,</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-print&quot;</span><span class="ot">,</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-speech&quot;</span><span class="ot">,</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-speech-to-text&quot;</span><span class="ot">,</span></span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-text-to-speech&quot;</span><span class="ot">,</span></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-barcode-scanner&quot;</span><span class="ot">,</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-face-detector&quot;</span><span class="ot">,</span></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-gl&quot;</span><span class="ot">,</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-gl-cpp&quot;</span><span class="ot">,</span></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three&quot;</span><span class="ot">,</span></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-orbit-controls&quot;</span><span class="ot">,</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-text&quot;</span><span class="ot">,</span></span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-texture-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-fbx-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-obj-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-mtl-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-collada-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-stl-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-plt-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-3ds-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-amf-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-assimp-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-dae-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-ctm-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-lwo-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-md2-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-pdb-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-prwm-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-stl-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-vrm-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-vtk-loader&quot;</span><span class="ot">,</span></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;expo-three-x-loader&quot;</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;scheme&quot;</span><span class="fu">:</span> <span class="st">&quot;socialplanr&quot;</span><span class="fu">,</span></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;extra&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;router&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;origin&quot;</span><span class="fu">:</span> <span class="kw">false</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">},</span></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;eas&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;projectId&quot;</span><span class="fu">:</span> <span class="st">&quot;your-project-id&quot;</span></span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p><strong>Configuration Metro Bundler :</strong></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// metro.config.js</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { getDefaultConfig } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;expo/metro-config&#39;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> { withNativeWind } <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;nativewind/metro&#39;</span>)<span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> config <span class="op">=</span> <span class="fu">getDefaultConfig</span>(<span class="bu">__dirname</span>)<span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Optimisations pour les performances</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="at">resolver</span><span class="op">.</span><span class="at">platforms</span> <span class="op">=</span> [<span class="st">&#39;ios&#39;</span><span class="op">,</span> <span class="st">&#39;android&#39;</span><span class="op">,</span> <span class="st">&#39;native&#39;</span><span class="op">,</span> <span class="st">&#39;web&#39;</span>]<span class="op">;</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="at">transformer</span><span class="op">.</span><span class="at">minifierConfig</span> <span class="op">=</span> {</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">keep_fnames</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">mangle</span><span class="op">:</span> {</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">keep_fnames</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Support des assets</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="at">resolver</span><span class="op">.</span><span class="at">assetExts</span><span class="op">.</span><span class="fu">push</span>(<span class="st">&#39;db&#39;</span><span class="op">,</span> <span class="st">&#39;mp3&#39;</span><span class="op">,</span> <span class="st">&#39;ttf&#39;</span><span class="op">,</span> <span class="st">&#39;obj&#39;</span><span class="op">,</span> <span class="st">&#39;png&#39;</span><span class="op">,</span> <span class="st">&#39;jpg&#39;</span>)<span class="op">;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">// Cache configuration</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>config<span class="op">.</span><span class="at">cacheStores</span> <span class="op">=</span> [</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;metro-cache&#39;</span><span class="op">,</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;file&#39;</span><span class="op">,</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">options</span><span class="op">:</span> {</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// 24 hours</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> <span class="fu">withNativeWind</span>(config<span class="op">,</span> { <span class="dt">input</span><span class="op">:</span> <span class="st">&#39;./global.css&#39;</span> })<span class="op">;</span></span></code></pre></div>
<p><strong>Configuration TypeScript avancée :</strong></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;compilerOptions&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;target&quot;</span><span class="fu">:</span> <span class="st">&quot;ES2020&quot;</span><span class="fu">,</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;lib&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;ES2020&quot;</span><span class="ot">,</span> <span class="st">&quot;DOM&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;allowJs&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;skipLibCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;esModuleInterop&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;allowSyntheticDefaultImports&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;strict&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;moduleResolution&quot;</span><span class="fu">:</span> <span class="st">&quot;node&quot;</span><span class="fu">,</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;resolveJsonModule&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;isolatedModules&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;noEmit&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;jsx&quot;</span><span class="fu">:</span> <span class="st">&quot;react-jsx&quot;</span><span class="fu">,</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;baseUrl&quot;</span><span class="fu">:</span> <span class="st">&quot;.&quot;</span><span class="fu">,</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;paths&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/components/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/components/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/screens/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/screens/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/services/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/services/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/utils/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/utils/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/types/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/types/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/hooks/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/hooks/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/constants/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/constants/*&quot;</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&quot;@/assets/*&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;./src/assets/*&quot;</span><span class="ot">]</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;types&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;react&quot;</span><span class="ot">,</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;react-native&quot;</span><span class="ot">,</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;jest&quot;</span><span class="ot">,</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;node&quot;</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;plugins&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;typescript-plugin-css-modules&quot;</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">},</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;include&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;**/*.ts&quot;</span><span class="ot">,</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;**/*.tsx&quot;</span><span class="ot">,</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;**/*.js&quot;</span><span class="ot">,</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;**/*.jsx&quot;</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;exclude&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;node_modules&quot;</span><span class="ot">,</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;babel.config.js&quot;</span><span class="ot">,</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;metro.config.js&quot;</span><span class="ot">,</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;jest.config.js&quot;</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="architecture-frontend-web-next.js-15">9.2 Architecture Frontend
Web (Next.js 15)</h4>
<p><strong>Configuration Next.js avancée :</strong></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">// next.config.ts</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="im">type</span> { NextConfig } <span class="im">from</span> <span class="st">&#39;next&#39;</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nextConfig<span class="op">:</span> NextConfig <span class="op">=</span> {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  experimental<span class="op">:</span> {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    appDir<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    serverComponentsExternalPackages<span class="op">:</span> [<span class="st">&#39;@prisma/client&#39;</span>]<span class="op">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    turbo<span class="op">:</span> {</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>      rules<span class="op">:</span> {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;*.svg&#39;</span><span class="op">:</span> {</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>          loaders<span class="op">:</span> [<span class="st">&#39;@svgr/webpack&#39;</span>]<span class="op">,</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>          as<span class="op">:</span> <span class="st">&#39;*.js&#39;</span><span class="op">,</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Optimisations de performance</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  compress<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  poweredByHeader<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  generateEtags<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration des images</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  images<span class="op">:</span> {</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    domains<span class="op">:</span> [</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;firebasestorage.googleapis.com&#39;</span><span class="op">,</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;lh3.googleusercontent.com&#39;</span><span class="op">,</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;graph.facebook.com&#39;</span><span class="op">,</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">&#39;platform-lookaside.fbsbx.com&#39;</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    formats<span class="op">:</span> [<span class="st">&#39;image/webp&#39;</span><span class="op">,</span> <span class="st">&#39;image/avif&#39;</span>]<span class="op">,</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    deviceSizes<span class="op">:</span> [<span class="dv">640</span><span class="op">,</span> <span class="dv">750</span><span class="op">,</span> <span class="dv">828</span><span class="op">,</span> <span class="dv">1080</span><span class="op">,</span> <span class="dv">1200</span><span class="op">,</span> <span class="dv">1920</span><span class="op">,</span> <span class="dv">2048</span><span class="op">,</span> <span class="dv">3840</span>]<span class="op">,</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    imageSizes<span class="op">:</span> [<span class="dv">16</span><span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">48</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="dv">96</span><span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="dv">256</span><span class="op">,</span> <span class="dv">384</span>]<span class="op">,</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration des headers de sécurité</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">headers</span>() {</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>        source<span class="op">:</span> <span class="st">&#39;/(.*)&#39;</span><span class="op">,</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">:</span> [</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;X-Frame-Options&#39;</span><span class="op">,</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;DENY&#39;</span><span class="op">,</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;X-Content-Type-Options&#39;</span><span class="op">,</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;nosniff&#39;</span><span class="op">,</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;Referrer-Policy&#39;</span><span class="op">,</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;origin-when-cross-origin&#39;</span><span class="op">,</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;X-XSS-Protection&#39;</span><span class="op">,</span></span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;1; mode=block&#39;</span><span class="op">,</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;Strict-Transport-Security&#39;</span><span class="op">,</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&#39;max-age=31536000; includeSubDomains&#39;</span><span class="op">,</span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>            key<span class="op">:</span> <span class="st">&#39;Content-Security-Policy&#39;</span><span class="op">,</span></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>            value<span class="op">:</span> <span class="st">&quot;default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-eval&#39; &#39;unsafe-inline&#39; https://www.googletagmanager.com https://www.google-analytics.com; style-src &#39;self&#39; &#39;unsafe-inline&#39; https://fonts.googleapis.com; font-src &#39;self&#39; https://fonts.gstatic.com; img-src &#39;self&#39; data: https: blob:; connect-src &#39;self&#39; https://api.socialplanr.com https://www.google-analytics.com; frame-src &#39;self&#39; https://www.google.com; object-src &#39;none&#39;; base-uri &#39;self&#39;; form-action &#39;self&#39;;&quot;</span><span class="op">,</span></span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">,</span></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration des redirections</span></span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">redirects</span>() {</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>        source<span class="op">:</span> <span class="st">&#39;/home&#39;</span><span class="op">,</span></span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>        permanent<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>        source<span class="op">:</span> <span class="st">&#39;/app&#39;</span><span class="op">,</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">:</span> <span class="st">&#39;/dashboard&#39;</span><span class="op">,</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>        permanent<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration des rewrites</span></span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="fu">rewrites</span>() {</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>        source<span class="op">:</span> <span class="st">&#39;/api/:path*&#39;</span><span class="op">,</span></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">:</span> <span class="st">&#39;https://api.socialplanr.com/:path*&#39;</span><span class="op">,</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration webpack</span></span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>  webpack<span class="op">:</span> (config<span class="op">,</span> { buildId<span class="op">,</span> dev<span class="op">,</span> isServer<span class="op">,</span> defaultLoaders<span class="op">,</span> webpack }) <span class="kw">=&gt;</span> {</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Optimisations pour les performances</span></span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>    config<span class="op">.</span><span class="at">optimization</span> <span class="op">=</span> {</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>config<span class="op">.</span><span class="at">optimization</span><span class="op">,</span></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>      splitChunks<span class="op">:</span> {</span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>        chunks<span class="op">:</span> <span class="st">&#39;all&#39;</span><span class="op">,</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>        cacheGroups<span class="op">:</span> {</span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>          vendor<span class="op">:</span> {</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>            test<span class="op">:</span> <span class="ss">/</span><span class="sc">[\\/]</span><span class="ss">node_modules</span><span class="sc">[\\/]</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>            name<span class="op">:</span> <span class="st">&#39;vendors&#39;</span><span class="op">,</span></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>            chunks<span class="op">:</span> <span class="st">&#39;all&#39;</span><span class="op">,</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>          common<span class="op">:</span> {</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>            name<span class="op">:</span> <span class="st">&#39;common&#39;</span><span class="op">,</span></span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>            minChunks<span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>            chunks<span class="op">:</span> <span class="st">&#39;all&#39;</span><span class="op">,</span></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>            enforce<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Support des modules CSS</span></span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>    config<span class="op">.</span><span class="at">module</span><span class="op">.</span><span class="at">rules</span><span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a>      test<span class="op">:</span> <span class="ss">/</span><span class="sc">\.</span><span class="ss">css</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a>      use<span class="op">:</span> [<span class="st">&#39;style-loader&#39;</span><span class="op">,</span> <span class="st">&#39;css-loader&#39;</span><span class="op">,</span> <span class="st">&#39;postcss-loader&#39;</span>]<span class="op">,</span></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Support des fichiers SVG</span></span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a>    config<span class="op">.</span><span class="at">module</span><span class="op">.</span><span class="at">rules</span><span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>      test<span class="op">:</span> <span class="ss">/</span><span class="sc">\.</span><span class="ss">svg</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span></span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>      use<span class="op">:</span> [<span class="st">&#39;@svgr/webpack&#39;</span>]<span class="op">,</span></span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> config<span class="op">;</span></span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Configuration PWA</span></span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a>  pwa<span class="op">:</span> {</span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a>    dest<span class="op">:</span> <span class="st">&#39;public&#39;</span><span class="op">,</span></span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>    register<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a>    skipWaiting<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a>    disable<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span> <span class="op">===</span> <span class="st">&#39;development&#39;</span><span class="op">,</span></span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="im">default</span> nextConfig<span class="op">;</span></span></code></pre></div>
<p><strong>Configuration Tailwind CSS avancée :</strong></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// tailwind.config.js</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> defaultTheme <span class="op">=</span> <span class="pp">require</span>(<span class="st">&#39;tailwindcss/defaultTheme&#39;</span>)<span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>module<span class="op">.</span><span class="at">exports</span> <span class="op">=</span> {</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">content</span><span class="op">:</span> [</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./src/pages/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./src/components/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;./src/app/**/*.{js,ts,jsx,tsx,mdx}&#39;</span><span class="op">,</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">theme</span><span class="op">:</span> {</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">extend</span><span class="op">:</span> {</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colors</span><span class="op">:</span> {</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">primary</span><span class="op">:</span> {</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>          <span class="dv">50</span><span class="op">:</span> <span class="st">&#39;#eff6ff&#39;</span><span class="op">,</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>          <span class="dv">100</span><span class="op">:</span> <span class="st">&#39;#dbeafe&#39;</span><span class="op">,</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>          <span class="dv">200</span><span class="op">:</span> <span class="st">&#39;#bfdbfe&#39;</span><span class="op">,</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>          <span class="dv">300</span><span class="op">:</span> <span class="st">&#39;#93c5fd&#39;</span><span class="op">,</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>          <span class="dv">400</span><span class="op">:</span> <span class="st">&#39;#60a5fa&#39;</span><span class="op">,</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>          <span class="dv">500</span><span class="op">:</span> <span class="st">&#39;#3b82f6&#39;</span><span class="op">,</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>          <span class="dv">600</span><span class="op">:</span> <span class="st">&#39;#2563eb&#39;</span><span class="op">,</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>          <span class="dv">700</span><span class="op">:</span> <span class="st">&#39;#1d4ed8&#39;</span><span class="op">,</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>          <span class="dv">800</span><span class="op">:</span> <span class="st">&#39;#1e40af&#39;</span><span class="op">,</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>          <span class="dv">900</span><span class="op">:</span> <span class="st">&#39;#1e3a8a&#39;</span><span class="op">,</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>          <span class="dv">950</span><span class="op">:</span> <span class="st">&#39;#172554&#39;</span><span class="op">,</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">secondary</span><span class="op">:</span> {</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>          <span class="dv">50</span><span class="op">:</span> <span class="st">&#39;#faf5ff&#39;</span><span class="op">,</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>          <span class="dv">100</span><span class="op">:</span> <span class="st">&#39;#f3e8ff&#39;</span><span class="op">,</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>          <span class="dv">200</span><span class="op">:</span> <span class="st">&#39;#e9d5ff&#39;</span><span class="op">,</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>          <span class="dv">300</span><span class="op">:</span> <span class="st">&#39;#d8b4fe&#39;</span><span class="op">,</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>          <span class="dv">400</span><span class="op">:</span> <span class="st">&#39;#c084fc&#39;</span><span class="op">,</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>          <span class="dv">500</span><span class="op">:</span> <span class="st">&#39;#a855f7&#39;</span><span class="op">,</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>          <span class="dv">600</span><span class="op">:</span> <span class="st">&#39;#9333ea&#39;</span><span class="op">,</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>          <span class="dv">700</span><span class="op">:</span> <span class="st">&#39;#7c3aed&#39;</span><span class="op">,</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>          <span class="dv">800</span><span class="op">:</span> <span class="st">&#39;#6b21a8&#39;</span><span class="op">,</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>          <span class="dv">900</span><span class="op">:</span> <span class="st">&#39;#581c87&#39;</span><span class="op">,</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>          <span class="dv">950</span><span class="op">:</span> <span class="st">&#39;#3b0764&#39;</span><span class="op">,</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">success</span><span class="op">:</span> {</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>          <span class="dv">50</span><span class="op">:</span> <span class="st">&#39;#f0fdf4&#39;</span><span class="op">,</span></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>          <span class="dv">100</span><span class="op">:</span> <span class="st">&#39;#dcfce7&#39;</span><span class="op">,</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>          <span class="dv">200</span><span class="op">:</span> <span class="st">&#39;#bbf7d0&#39;</span><span class="op">,</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>          <span class="dv">300</span><span class="op">:</span> <span class="st">&#39;#86efac&#39;</span><span class="op">,</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>          <span class="dv">400</span><span class="op">:</span> <span class="st">&#39;#4ade80&#39;</span><span class="op">,</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>          <span class="dv">500</span><span class="op">:</span> <span class="st">&#39;#22c55e&#39;</span><span class="op">,</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>          <span class="dv">600</span><span class="op">:</span> <span class="st">&#39;#16a34a&#39;</span><span class="op">,</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>          <span class="dv">700</span><span class="op">:</span> <span class="st">&#39;#15803d&#39;</span><span class="op">,</span></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>          <span class="dv">800</span><span class="op">:</span> <span class="st">&#39;#166534&#39;</span><span class="op">,</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>          <span class="dv">900</span><span class="op">:</span> <span class="st">&#39;#14532d&#39;</span><span class="op">,</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>          <span class="dv">950</span><span class="op">:</span> <span class="st">&#39;#052e16&#39;</span><span class="op">,</span></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>        <span class="dt">warning</span><span class="op">:</span> {</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>          <span class="dv">50</span><span class="op">:</span> <span class="st">&#39;#fffbeb&#39;</span><span class="op">,</span></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>          <span class="dv">100</span><span class="op">:</span> <span class="st">&#39;#fef3c7&#39;</span><span class="op">,</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>          <span class="dv">200</span><span class="op">:</span> <span class="st">&#39;#fde68a&#39;</span><span class="op">,</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>          <span class="dv">300</span><span class="op">:</span> <span class="st">&#39;#fcd34d&#39;</span><span class="op">,</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>          <span class="dv">400</span><span class="op">:</span> <span class="st">&#39;#fbbf24&#39;</span><span class="op">,</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>          <span class="dv">500</span><span class="op">:</span> <span class="st">&#39;#f59e0b&#39;</span><span class="op">,</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>          <span class="dv">600</span><span class="op">:</span> <span class="st">&#39;#d97706&#39;</span><span class="op">,</span></span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>          <span class="dv">700</span><span class="op">:</span> <span class="st">&#39;#b45309&#39;</span><span class="op">,</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>          <span class="dv">800</span><span class="op">:</span> <span class="st">&#39;#92400e&#39;</span><span class="op">,</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>          <span class="dv">900</span><span class="op">:</span> <span class="st">&#39;#78350f&#39;</span><span class="op">,</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>          <span class="dv">950</span><span class="op">:</span> <span class="st">&#39;#451a03&#39;</span><span class="op">,</span></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>        <span class="dt">error</span><span class="op">:</span> {</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>          <span class="dv">50</span><span class="op">:</span> <span class="st">&#39;#fef2f2&#39;</span><span class="op">,</span></span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>          <span class="dv">100</span><span class="op">:</span> <span class="st">&#39;#fee2e2&#39;</span><span class="op">,</span></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>          <span class="dv">200</span><span class="op">:</span> <span class="st">&#39;#fecaca&#39;</span><span class="op">,</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>          <span class="dv">300</span><span class="op">:</span> <span class="st">&#39;#fca5a5&#39;</span><span class="op">,</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>          <span class="dv">400</span><span class="op">:</span> <span class="st">&#39;#f87171&#39;</span><span class="op">,</span></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>          <span class="dv">500</span><span class="op">:</span> <span class="st">&#39;#ef4444&#39;</span><span class="op">,</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>          <span class="dv">600</span><span class="op">:</span> <span class="st">&#39;#dc2626&#39;</span><span class="op">,</span></span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>          <span class="dv">700</span><span class="op">:</span> <span class="st">&#39;#b91c1c&#39;</span><span class="op">,</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>          <span class="dv">800</span><span class="op">:</span> <span class="st">&#39;#991b1b&#39;</span><span class="op">,</span></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>          <span class="dv">900</span><span class="op">:</span> <span class="st">&#39;#7f1d1d&#39;</span><span class="op">,</span></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>          <span class="dv">950</span><span class="op">:</span> <span class="st">&#39;#450a0a&#39;</span><span class="op">,</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontFamily</span><span class="op">:</span> {</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sans</span><span class="op">:</span> [<span class="st">&#39;Inter&#39;</span><span class="op">,</span> <span class="op">...</span>defaultTheme<span class="op">.</span><span class="at">fontFamily</span><span class="op">.</span><span class="at">sans</span>]<span class="op">,</span></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mono</span><span class="op">:</span> [<span class="st">&#39;JetBrains Mono&#39;</span><span class="op">,</span> <span class="op">...</span>defaultTheme<span class="op">.</span><span class="at">fontFamily</span><span class="op">.</span><span class="at">mono</span>]<span class="op">,</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> {</span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;xs&#39;</span><span class="op">:</span> [<span class="st">&#39;0.75rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;sm&#39;</span><span class="op">:</span> [<span class="st">&#39;0.875rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1.25rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;base&#39;</span><span class="op">:</span> [<span class="st">&#39;1rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1.5rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;lg&#39;</span><span class="op">:</span> [<span class="st">&#39;1.125rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1.75rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;xl&#39;</span><span class="op">:</span> [<span class="st">&#39;1.25rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1.75rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;2xl&#39;</span><span class="op">:</span> [<span class="st">&#39;1.5rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;2rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;3xl&#39;</span><span class="op">:</span> [<span class="st">&#39;1.875rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;2.25rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;4xl&#39;</span><span class="op">:</span> [<span class="st">&#39;2.25rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;2.5rem&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;5xl&#39;</span><span class="op">:</span> [<span class="st">&#39;3rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;6xl&#39;</span><span class="op">:</span> [<span class="st">&#39;3.75rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;7xl&#39;</span><span class="op">:</span> [<span class="st">&#39;4.5rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;8xl&#39;</span><span class="op">:</span> [<span class="st">&#39;6rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;9xl&#39;</span><span class="op">:</span> [<span class="st">&#39;8rem&#39;</span><span class="op">,</span> { <span class="dt">lineHeight</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }]<span class="op">,</span></span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>      <span class="dt">spacing</span><span class="op">:</span> {</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;18&#39;</span><span class="op">:</span> <span class="st">&#39;4.5rem&#39;</span><span class="op">,</span></span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;88&#39;</span><span class="op">:</span> <span class="st">&#39;22rem&#39;</span><span class="op">,</span></span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;128&#39;</span><span class="op">:</span> <span class="st">&#39;32rem&#39;</span><span class="op">,</span></span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>      <span class="dt">animation</span><span class="op">:</span> {</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;fade-in&#39;</span><span class="op">:</span> <span class="st">&#39;fadeIn 0.5s ease-in-out&#39;</span><span class="op">,</span></span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;fade-out&#39;</span><span class="op">:</span> <span class="st">&#39;fadeOut 0.5s ease-in-out&#39;</span><span class="op">,</span></span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;slide-in&#39;</span><span class="op">:</span> <span class="st">&#39;slideIn 0.3s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;slide-out&#39;</span><span class="op">:</span> <span class="st">&#39;slideOut 0.3s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;scale-in&#39;</span><span class="op">:</span> <span class="st">&#39;scaleIn 0.2s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;scale-out&#39;</span><span class="op">:</span> <span class="st">&#39;scaleOut 0.2s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;bounce-in&#39;</span><span class="op">:</span> <span class="st">&#39;bounceIn 0.6s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;bounce-out&#39;</span><span class="op">:</span> <span class="st">&#39;bounceOut 0.6s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;rotate-in&#39;</span><span class="op">:</span> <span class="st">&#39;rotateIn 0.6s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;rotate-out&#39;</span><span class="op">:</span> <span class="st">&#39;rotateOut 0.6s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;flip-in&#39;</span><span class="op">:</span> <span class="st">&#39;flipIn 0.6s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;flip-out&#39;</span><span class="op">:</span> <span class="st">&#39;flipOut 0.6s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;hinge&#39;</span><span class="op">:</span> <span class="st">&#39;hinge 2s ease-in-out&#39;</span><span class="op">,</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;roll-in&#39;</span><span class="op">:</span> <span class="st">&#39;rollIn 0.6s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;roll-out&#39;</span><span class="op">:</span> <span class="st">&#39;rollOut 0.6s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;zoom-in&#39;</span><span class="op">:</span> <span class="st">&#39;zoomIn 0.3s ease-out&#39;</span><span class="op">,</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;zoom-out&#39;</span><span class="op">:</span> <span class="st">&#39;zoomOut 0.3s ease-in&#39;</span><span class="op">,</span></span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;pulse&#39;</span><span class="op">:</span> <span class="st">&#39;pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite&#39;</span><span class="op">,</span></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;ping&#39;</span><span class="op">:</span> <span class="st">&#39;ping 1s cubic-bezier(0, 0, 0.2, 1) infinite&#39;</span><span class="op">,</span></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;bounce&#39;</span><span class="op">:</span> <span class="st">&#39;bounce 1s infinite&#39;</span><span class="op">,</span></span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;spin&#39;</span><span class="op">:</span> <span class="st">&#39;spin 1s linear infinite&#39;</span><span class="op">,</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">keyframes</span><span class="op">:</span> {</span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fadeIn</span><span class="op">:</span> {</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fadeOut</span><span class="op">:</span> {</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>        <span class="dt">slideIn</span><span class="op">:</span> {</span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(-100%)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(0)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>        <span class="dt">slideOut</span><span class="op">:</span> {</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(0)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(-100%)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scaleIn</span><span class="op">:</span> {</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>        <span class="dt">scaleOut</span><span class="op">:</span> {</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bounceIn</span><span class="op">:</span> {</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.3)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;50%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1.05)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;70%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.9)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bounceOut</span><span class="op">:</span> {</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;20%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.9)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;50%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1.05)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.3)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rotateIn</span><span class="op">:</span> {</span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(-200deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(0)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rotateOut</span><span class="op">:</span> {</span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(0)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(200deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>        <span class="dt">flipIn</span><span class="op">:</span> {</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(90deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;40%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(-20deg)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;60%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(10deg)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;80%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(-5deg)&#39;</span> }<span class="op">,</span></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(0deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">flipOut</span><span class="op">:</span> {</span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(0deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;perspective(400px) rotateY(90deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hinge</span><span class="op">:</span> {</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(0)&#39;</span><span class="op">,</span> <span class="dt">transformOrigin</span><span class="op">:</span> <span class="st">&#39;top left&#39;</span><span class="op">,</span> <span class="dt">animationTimingFunction</span><span class="op">:</span> <span class="st">&#39;ease-in-out&#39;</span> }<span class="op">,</span></span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;20%, 60%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(80deg)&#39;</span><span class="op">,</span> <span class="dt">transformOrigin</span><span class="op">:</span> <span class="st">&#39;top left&#39;</span><span class="op">,</span> <span class="dt">animationTimingFunction</span><span class="op">:</span> <span class="st">&#39;ease-in-out&#39;</span> }<span class="op">,</span></span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;40%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(60deg)&#39;</span><span class="op">,</span> <span class="dt">transformOrigin</span><span class="op">:</span> <span class="st">&#39;top left&#39;</span><span class="op">,</span> <span class="dt">animationTimingFunction</span><span class="op">:</span> <span class="st">&#39;ease-in-out&#39;</span> }<span class="op">,</span></span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;80%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;rotate(60deg) translateY(0)&#39;</span><span class="op">,</span> <span class="dt">transformOrigin</span><span class="op">:</span> <span class="st">&#39;top left&#39;</span><span class="op">,</span> <span class="dt">animationTimingFunction</span><span class="op">:</span> <span class="st">&#39;ease-in-out&#39;</span> }<span class="op">,</span></span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateY(700px)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rollIn</span><span class="op">:</span> {</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(-100%) rotate(-120deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(0) rotate(0deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rollOut</span><span class="op">:</span> {</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(0) rotate(0deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;translateX(-100%) rotate(-120deg)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zoomIn</span><span class="op">:</span> {</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.3)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;50%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>        <span class="dt">zoomOut</span><span class="op">:</span> {</span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;0%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(1)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;50%&#39;</span><span class="op">:</span> { <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;1&#39;</span> }<span class="op">,</span></span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;100%&#39;</span><span class="op">:</span> { <span class="dt">transform</span><span class="op">:</span> <span class="st">&#39;scale(0.3)&#39;</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="st">&#39;0&#39;</span> }<span class="op">,</span></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>      <span class="dt">backdropBlur</span><span class="op">:</span> {</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a>        <span class="dt">xs</span><span class="op">:</span> <span class="st">&#39;2px&#39;</span><span class="op">,</span></span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>      <span class="dt">boxShadow</span><span class="op">:</span> {</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;inner-lg&#39;</span><span class="op">:</span> <span class="st">&#39;inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)&#39;</span><span class="op">,</span></span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;inner-xl&#39;</span><span class="op">:</span> <span class="st">&#39;inset 0 4px 6px -1px rgba(0, 0, 0, 0.1), inset 0 2px 4px -1px rgba(0, 0, 0, 0.06)&#39;</span><span class="op">,</span></span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">borderRadius</span><span class="op">:</span> {</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;4xl&#39;</span><span class="op">:</span> <span class="st">&#39;2rem&#39;</span><span class="op">,</span></span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;5xl&#39;</span><span class="op">:</span> <span class="st">&#39;2.5rem&#39;</span><span class="op">,</span></span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>      <span class="dt">zIndex</span><span class="op">:</span> {</span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;60&#39;</span><span class="op">:</span> <span class="st">&#39;60&#39;</span><span class="op">,</span></span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;70&#39;</span><span class="op">:</span> <span class="st">&#39;70&#39;</span><span class="op">,</span></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;80&#39;</span><span class="op">:</span> <span class="st">&#39;80&#39;</span><span class="op">,</span></span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;90&#39;</span><span class="op">:</span> <span class="st">&#39;90&#39;</span><span class="op">,</span></span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>        <span class="st">&#39;100&#39;</span><span class="op">:</span> <span class="st">&#39;100&#39;</span><span class="op">,</span></span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>  <span class="dt">plugins</span><span class="op">:</span> [</span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/forms&#39;</span>)<span class="op">,</span></span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/typography&#39;</span>)<span class="op">,</span></span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/aspect-ratio&#39;</span>)<span class="op">,</span></span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/line-clamp&#39;</span>)<span class="op">,</span></span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;tailwindcss-animate&#39;</span>)<span class="op">,</span></span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a>    <span class="pp">require</span>(<span class="st">&#39;@tailwindcss/container-queries&#39;</span>)<span class="op">,</span></span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a>  <span class="dt">darkMode</span><span class="op">:</span> <span class="st">&#39;class&#39;</span><span class="op">,</span></span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>  <span class="dt">future</span><span class="op">:</span> {</span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hoverOnlyWhenSupported</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<h4 id="backend-architecture-node.js-typescript">9.3 Backend
Architecture (Node.js + TypeScript)</h4>
<p><strong>Configuration Express.js avancée :</strong></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">// app.ts</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> express <span class="im">from</span> <span class="st">&#39;express&#39;</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> helmet <span class="im">from</span> <span class="st">&#39;helmet&#39;</span><span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cors <span class="im">from</span> <span class="st">&#39;cors&#39;</span><span class="op">;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> compression <span class="im">from</span> <span class="st">&#39;compression&#39;</span><span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rateLimit <span class="im">from</span> <span class="st">&#39;express-rate-limit&#39;</span><span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> slowDown <span class="im">from</span> <span class="st">&#39;express-slow-down&#39;</span><span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> morgan <span class="im">from</span> <span class="st">&#39;morgan&#39;</span><span class="op">;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createServer } <span class="im">from</span> <span class="st">&#39;http&#39;</span><span class="op">;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { <span class="bu">Server</span> } <span class="im">from</span> <span class="st">&#39;socket.io&#39;</span><span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { config } <span class="im">from</span> <span class="st">&#39;dotenv&#39;</span><span class="op">;</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { connect } <span class="im">from</span> <span class="st">&#39;mongoose&#39;</span><span class="op">;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { createBullBoard } <span class="im">from</span> <span class="st">&#39;@bull-board/api&#39;</span><span class="op">;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { BullAdapter } <span class="im">from</span> <span class="st">&#39;@bull-board/api/bullAdapter&#39;</span><span class="op">;</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { ExpressAdapter } <span class="im">from</span> <span class="st">&#39;@bull-board/express&#39;</span><span class="op">;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { swaggerUi<span class="op">,</span> specs } <span class="im">from</span> <span class="st">&#39;./swagger&#39;</span><span class="op">;</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { errorHandler } <span class="im">from</span> <span class="st">&#39;./middleware/errorHandler&#39;</span><span class="op">;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { notFoundHandler } <span class="im">from</span> <span class="st">&#39;./middleware/notFoundHandler&#39;</span><span class="op">;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { requestLogger } <span class="im">from</span> <span class="st">&#39;./middleware/requestLogger&#39;</span><span class="op">;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { authMiddleware } <span class="im">from</span> <span class="st">&#39;./middleware/authMiddleware&#39;</span><span class="op">;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { validateRequest } <span class="im">from</span> <span class="st">&#39;./middleware/validateRequest&#39;</span><span class="op">;</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { cacheMiddleware } <span class="im">from</span> <span class="st">&#39;./middleware/cacheMiddleware&#39;</span><span class="op">;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { rateLimitMiddleware } <span class="im">from</span> <span class="st">&#39;./middleware/rateLimitMiddleware&#39;</span><span class="op">;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { securityMiddleware } <span class="im">from</span> <span class="st">&#39;./middleware/securityMiddleware&#39;</span><span class="op">;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { monitoringMiddleware } <span class="im">from</span> <span class="st">&#39;./middleware/monitoringMiddleware&#39;</span><span class="op">;</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Routes</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> authRoutes <span class="im">from</span> <span class="st">&#39;./routes/auth&#39;</span><span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> userRoutes <span class="im">from</span> <span class="st">&#39;./routes/users&#39;</span><span class="op">;</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> groupRoutes <span class="im">from</span> <span class="st">&#39;./routes/groups&#39;</span><span class="op">;</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> eventRoutes <span class="im">from</span> <span class="st">&#39;./routes/events&#39;</span><span class="op">;</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> expenseRoutes <span class="im">from</span> <span class="st">&#39;./routes/expenses&#39;</span><span class="op">;</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> notificationRoutes <span class="im">from</span> <span class="st">&#39;./routes/notifications&#39;</span><span class="op">;</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> analyticsRoutes <span class="im">from</span> <span class="st">&#39;./routes/analytics&#39;</span><span class="op">;</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> webhookRoutes <span class="im">from</span> <span class="st">&#39;./routes/webhooks&#39;</span><span class="op">;</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="co">// Services</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { DatabaseService } <span class="im">from</span> <span class="st">&#39;./services/DatabaseService&#39;</span><span class="op">;</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { RedisService } <span class="im">from</span> <span class="st">&#39;./services/RedisService&#39;</span><span class="op">;</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { EmailService } <span class="im">from</span> <span class="st">&#39;./services/EmailService&#39;</span><span class="op">;</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { NotificationService } <span class="im">from</span> <span class="st">&#39;./services/NotificationService&#39;</span><span class="op">;</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { AnalyticsService } <span class="im">from</span> <span class="st">&#39;./services/AnalyticsService&#39;</span><span class="op">;</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { AIService } <span class="im">from</span> <span class="st">&#39;./services/AIService&#39;</span><span class="op">;</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { PaymentService } <span class="im">from</span> <span class="st">&#39;./services/PaymentService&#39;</span><span class="op">;</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { BookingService } <span class="im">from</span> <span class="st">&#39;./services/BookingService&#39;</span><span class="op">;</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co">// Load environment variables</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="fu">config</span>()<span class="op">;</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> app <span class="op">=</span> <span class="fu">express</span>()<span class="op">;</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> server <span class="op">=</span> <span class="fu">createServer</span>(app)<span class="op">;</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> io <span class="op">=</span> <span class="kw">new</span> <span class="bu">Server</span>(server<span class="op">,</span> {</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  cors<span class="op">:</span> {</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    origin<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">FRONTEND_URL</span><span class="op">,</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>    methods<span class="op">:</span> [<span class="st">&#39;GET&#39;</span><span class="op">,</span> <span class="st">&#39;POST&#39;</span>]<span class="op">,</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>    credentials<span class="op">:</span> <span class="kw">true</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="co">// Database connection</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> databaseService <span class="op">=</span> <span class="kw">new</span> <span class="fu">DatabaseService</span>()<span class="op">;</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>databaseService<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="co">// Redis connection</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> redisService <span class="op">=</span> <span class="kw">new</span> <span class="fu">RedisService</span>()<span class="op">;</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>redisService<span class="op">.</span><span class="fu">connect</span>()<span class="op">;</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize services</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> emailService <span class="op">=</span> <span class="kw">new</span> <span class="fu">EmailService</span>()<span class="op">;</span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> notificationService <span class="op">=</span> <span class="kw">new</span> <span class="fu">NotificationService</span>(io)<span class="op">;</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> analyticsService <span class="op">=</span> <span class="kw">new</span> <span class="fu">AnalyticsService</span>()<span class="op">;</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> aiService <span class="op">=</span> <span class="kw">new</span> <span class="fu">AIService</span>()<span class="op">;</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> paymentService <span class="op">=</span> <span class="kw">new</span> <span class="fu">PaymentService</span>()<span class="op">;</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> bookingService <span class="op">=</span> <span class="kw">new</span> <span class="fu">BookingService</span>()<span class="op">;</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="co">// Security middleware</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">helmet</span>({</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>  contentSecurityPolicy<span class="op">:</span> {</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    directives<span class="op">:</span> {</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>      defaultSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span>]<span class="op">,</span></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>      styleSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span><span class="op">,</span> <span class="st">&quot;&#39;unsafe-inline&#39;&quot;</span><span class="op">,</span> <span class="st">&quot;https://fonts.googleapis.com&quot;</span>]<span class="op">,</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>      fontSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span><span class="op">,</span> <span class="st">&quot;https://fonts.gstatic.com&quot;</span>]<span class="op">,</span></span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>      imgSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span><span class="op">,</span> <span class="st">&quot;data:&quot;</span><span class="op">,</span> <span class="st">&quot;https:&quot;</span>]<span class="op">,</span></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>      scriptSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span>]<span class="op">,</span></span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>      connectSrc<span class="op">:</span> [<span class="st">&quot;&#39;self&#39;&quot;</span><span class="op">,</span> <span class="st">&quot;https://api.openai.com&quot;</span><span class="op">,</span> <span class="st">&quot;https://api.stripe.com&quot;</span>]<span class="op">,</span></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>  crossOriginEmbedderPolicy<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a><span class="co">// CORS configuration</span></span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">cors</span>({</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>  origin<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">FRONTEND_URL</span><span class="op">,</span></span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>  credentials<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>  methods<span class="op">:</span> [<span class="st">&#39;GET&#39;</span><span class="op">,</span> <span class="st">&#39;POST&#39;</span><span class="op">,</span> <span class="st">&#39;PUT&#39;</span><span class="op">,</span> <span class="st">&#39;DELETE&#39;</span><span class="op">,</span> <span class="st">&#39;PATCH&#39;</span><span class="op">,</span> <span class="st">&#39;OPTIONS&#39;</span>]<span class="op">,</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>  allowedHeaders<span class="op">:</span> [<span class="st">&#39;Content-Type&#39;</span><span class="op">,</span> <span class="st">&#39;Authorization&#39;</span><span class="op">,</span> <span class="st">&#39;X-Requested-With&#39;</span>]<span class="op">,</span></span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a><span class="co">// Compression</span></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="fu">compression</span>())<span class="op">;</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a><span class="co">// Rate limiting</span></span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> limiter <span class="op">=</span> <span class="fu">rateLimit</span>({</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>  windowMs<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>  max<span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="co">// limit each IP to 100 requests per windowMs</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>  message<span class="op">:</span> <span class="st">&#39;Too many requests from this IP, please try again later.&#39;</span><span class="op">,</span></span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>  standardHeaders<span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>  legacyHeaders<span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> speedLimiter <span class="op">=</span> <span class="fu">slowDown</span>({</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>  windowMs<span class="op">:</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span><span class="op">,</span> <span class="co">// 15 minutes</span></span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a>  delayAfter<span class="op">:</span> <span class="dv">50</span><span class="op">,</span> <span class="co">// allow 50 requests per 15 minutes, then...</span></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a>  delayMs<span class="op">:</span> <span class="dv">500</span> <span class="co">// begin adding 500ms of delay per request above 50</span></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/&#39;</span><span class="op">,</span> limiter)<span class="op">;</span></span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/&#39;</span><span class="op">,</span> speedLimiter)<span class="op">;</span></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a><span class="co">// Logging</span></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span> <span class="op">===</span> <span class="st">&#39;development&#39;</span>) {</span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="fu">use</span>(<span class="fu">morgan</span>(<span class="st">&#39;dev&#39;</span>))<span class="op">;</span></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="fu">use</span>(<span class="fu">morgan</span>(<span class="st">&#39;combined&#39;</span>))<span class="op">;</span></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a><span class="co">// Body parsing</span></span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">json</span>({ limit<span class="op">:</span> <span class="st">&#39;10mb&#39;</span> }))<span class="op">;</span></span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(express<span class="op">.</span><span class="fu">urlencoded</span>({ extended<span class="op">:</span> <span class="kw">true</span><span class="op">,</span> limit<span class="op">:</span> <span class="st">&#39;10mb&#39;</span> }))<span class="op">;</span></span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-131"><a href="#cb25-131" aria-hidden="true" tabindex="-1"></a><span class="co">// Request logging</span></span>
<span id="cb25-132"><a href="#cb25-132" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(requestLogger)<span class="op">;</span></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="co">// Monitoring</span></span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(monitoringMiddleware)<span class="op">;</span></span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a><span class="co">// Bull Board (Job monitoring)</span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> serverAdapter <span class="op">=</span> <span class="kw">new</span> <span class="fu">ExpressAdapter</span>()<span class="op">;</span></span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a>serverAdapter<span class="op">.</span><span class="fu">setBasePath</span>(<span class="st">&#39;/admin/queues&#39;</span>)<span class="op">;</span></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a><span class="fu">createBullBoard</span>({</span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>  queues<span class="op">:</span> [</span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">BullAdapter</span>(emailService<span class="op">.</span><span class="at">queue</span>)<span class="op">,</span></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">BullAdapter</span>(notificationService<span class="op">.</span><span class="at">queue</span>)<span class="op">,</span></span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a>    <span class="kw">new</span> <span class="fu">BullAdapter</span>(analyticsService<span class="op">.</span><span class="at">queue</span>)<span class="op">,</span></span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>  serverAdapter<span class="op">,</span></span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/admin/queues&#39;</span><span class="op">,</span> serverAdapter<span class="op">.</span><span class="fu">getRouter</span>())<span class="op">;</span></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a><span class="co">// API Documentation</span></span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api-docs&#39;</span><span class="op">,</span> swaggerUi<span class="op">.</span><span class="at">serve</span><span class="op">,</span> swaggerUi<span class="op">.</span><span class="fu">setup</span>(specs))<span class="op">;</span></span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a><span class="co">// Health check</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">get</span>(<span class="st">&#39;/health&#39;</span><span class="op">,</span> (req<span class="op">,</span> res) <span class="kw">=&gt;</span> {</span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a>  res<span class="op">.</span><span class="fu">status</span>(<span class="dv">200</span>)<span class="op">.</span><span class="fu">json</span>({</span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a>    status<span class="op">:</span> <span class="st">&#39;OK&#39;</span><span class="op">,</span></span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a>    timestamp<span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>()<span class="op">,</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a>    uptime<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="fu">uptime</span>()<span class="op">,</span></span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a>    environment<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span><span class="op">,</span></span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a>    version<span class="op">:</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">npm_package_version</span><span class="op">,</span></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a><span class="co">// API Routes</span></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/auth&#39;</span><span class="op">,</span> authRoutes)<span class="op">;</span></span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/users&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> userRoutes)<span class="op">;</span></span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/groups&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> groupRoutes)<span class="op">;</span></span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/events&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> eventRoutes)<span class="op">;</span></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/expenses&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> expenseRoutes)<span class="op">;</span></span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/notifications&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> notificationRoutes)<span class="op">;</span></span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/analytics&#39;</span><span class="op">,</span> authMiddleware<span class="op">,</span> analyticsRoutes)<span class="op">;</span></span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(<span class="st">&#39;/api/webhooks&#39;</span><span class="op">,</span> webhookRoutes)<span class="op">;</span></span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a><span class="co">// WebSocket connection handling</span></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>io<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;connection&#39;</span><span class="op">,</span> (socket) <span class="kw">=&gt;</span> {</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;User connected:&#39;</span><span class="op">,</span> socket<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a>  socket<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;join-room&#39;</span><span class="op">,</span> (roomId) <span class="kw">=&gt;</span> {</span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a>    socket<span class="op">.</span><span class="fu">join</span>(roomId)<span class="op">;</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`User </span><span class="sc">${</span>socket<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs"> joined room </span><span class="sc">${</span>roomId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>  socket<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;leave-room&#39;</span><span class="op">,</span> (roomId) <span class="kw">=&gt;</span> {</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a>    socket<span class="op">.</span><span class="fu">leave</span>(roomId)<span class="op">;</span></span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`User </span><span class="sc">${</span>socket<span class="op">.</span><span class="at">id</span><span class="sc">}</span><span class="vs"> left room </span><span class="sc">${</span>roomId<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>  socket<span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;disconnect&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;User disconnected:&#39;</span><span class="op">,</span> socket<span class="op">.</span><span class="at">id</span>)<span class="op">;</span></span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a><span class="co">// Error handling</span></span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(notFoundHandler)<span class="op">;</span></span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">use</span>(errorHandler)<span class="op">;</span></span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a><span class="co">// Graceful shutdown</span></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a><span class="bu">process</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;SIGTERM&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;SIGTERM received, shutting down gracefully&#39;</span>)<span class="op">;</span></span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>  server<span class="op">.</span><span class="fu">close</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Process terminated&#39;</span>)<span class="op">;</span></span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a><span class="bu">process</span><span class="op">.</span><span class="fu">on</span>(<span class="st">&#39;SIGINT&#39;</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;SIGINT received, shutting down gracefully&#39;</span>)<span class="op">;</span></span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a>  server<span class="op">.</span><span class="fu">close</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Process terminated&#39;</span>)<span class="op">;</span></span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>    <span class="bu">process</span><span class="op">.</span><span class="fu">exit</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> PORT <span class="op">=</span> <span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">PORT</span> <span class="op">||</span> <span class="dv">3000</span><span class="op">;</span></span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>server<span class="op">.</span><span class="fu">listen</span>(PORT<span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Server running on port </span><span class="sc">${</span>PORT<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Environment: </span><span class="sc">${</span><span class="bu">process</span><span class="op">.</span><span class="at">env</span><span class="op">.</span><span class="at">NODE_ENV</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`API Documentation: http://localhost:</span><span class="sc">${</span>PORT<span class="sc">}</span><span class="vs">/api-docs`</span>)<span class="op">;</span></span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Queue Dashboard: http://localhost:</span><span class="sc">${</span>PORT<span class="sc">}</span><span class="vs">/admin/queues`</span>)<span class="op">;</span></span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> { app<span class="op">,</span> server<span class="op">,</span> io }<span class="op">;</span></span></code></pre></div>
<p><strong>Configuration Swagger/OpenAPI :</strong></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode typescript"><code class="sourceCode typescript"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">// swagger.ts</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> swaggerJsdoc <span class="im">from</span> <span class="st">&#39;swagger-jsdoc&#39;</span><span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> options <span class="op">=</span> {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  definition<span class="op">:</span> {</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    openapi<span class="op">:</span> <span class="st">&#39;3.0.0&#39;</span><span class="op">,</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    info<span class="op">:</span> {</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>      title<span class="op">:</span> <span class="st">&#39;SocialPlanr API&#39;</span><span class="op">,</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      version<span class="op">:</span> <span class="st">&#39;1.0.0&#39;</span><span class="op">,</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      description<span class="op">:</span> <span class="st">&#39;API documentation for SocialPlanr - Collaborative Event Management Platform&#39;</span><span class="op">,</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      contact<span class="op">:</span> {</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        name<span class="op">:</span> <span class="st">&#39;SocialPlanr Team&#39;</span><span class="op">,</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        email<span class="op">:</span> <span class="st">&#39;api@socialplanr.com&#39;</span><span class="op">,</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        url<span class="op">:</span> <span class="st">&#39;https://socialplanr.com&#39;</span><span class="op">,</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      license<span class="op">:</span> {</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        name<span class="op">:</span> <span class="st">&#39;MIT&#39;</span><span class="op">,</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        url<span class="op">:</span> <span class="st">&#39;https://opensource.org/licenses/MIT&#39;</span><span class="op">,</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    servers<span class="op">:</span> [</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        url<span class="op">:</span> <span class="st">&#39;https://api.socialplanr.com&#39;</span><span class="op">,</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        description<span class="op">:</span> <span class="st">&#39;Production server&#39;</span><span class="op">,</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        url<span class="op">:</span> <span class="st">&#39;https://staging-api.socialplanr.com&#39;</span><span class="op">,</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        description<span class="op">:</span> <span class="st">&#39;Staging server&#39;</span><span class="op">,</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        url<span class="op">:</span> <span class="st">&#39;http://localhost:3000&#39;</span><span class="op">,</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>        description<span class="op">:</span> <span class="st">&#39;Development server&#39;</span><span class="op">,</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    components<span class="op">:</span> {</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>      securitySchemes<span class="op">:</span> {</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>        bearerAuth<span class="op">:</span> {</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;http&#39;</span><span class="op">,</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>          scheme<span class="op">:</span> <span class="st">&#39;bearer&#39;</span><span class="op">,</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>          bearerFormat<span class="op">:</span> <span class="st">&#39;JWT&#39;</span><span class="op">,</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>        apiKeyAuth<span class="op">:</span> {</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;apiKey&#39;</span><span class="op">,</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>          <span class="kw">in</span><span class="op">:</span> <span class="st">&#39;header&#39;</span><span class="op">,</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>          name<span class="op">:</span> <span class="st">&#39;X-API-Key&#39;</span><span class="op">,</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>      schemas<span class="op">:</span> {</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>        User<span class="op">:</span> {</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>          properties<span class="op">:</span> {</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>            id<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>            email<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;email&#39;</span> }<span class="op">,</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>            firstName<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>            lastName<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>            displayName<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>            avatarUrl<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>            isActive<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;boolean&#39;</span> }<span class="op">,</span></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>            isVerified<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;boolean&#39;</span> }<span class="op">,</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>            createdAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>            updatedAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>          required<span class="op">:</span> [<span class="st">&#39;id&#39;</span><span class="op">,</span> <span class="st">&#39;email&#39;</span><span class="op">,</span> <span class="st">&#39;firstName&#39;</span><span class="op">,</span> <span class="st">&#39;lastName&#39;</span>]<span class="op">,</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>        Group<span class="op">:</span> {</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>          properties<span class="op">:</span> {</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>            id<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a>            name<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a>            description<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>            createdBy<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>            members<span class="op">:</span> {</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;array&#39;</span><span class="op">,</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>              items<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>            admins<span class="op">:</span> {</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;array&#39;</span><span class="op">,</span></span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>              items<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>            status<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> enum<span class="op">:</span> [<span class="st">&#39;active&#39;</span><span class="op">,</span> <span class="st">&#39;archived&#39;</span><span class="op">,</span> <span class="st">&#39;deleted&#39;</span>] }<span class="op">,</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>            createdAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>            updatedAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>          required<span class="op">:</span> [<span class="st">&#39;id&#39;</span><span class="op">,</span> <span class="st">&#39;name&#39;</span><span class="op">,</span> <span class="st">&#39;createdBy&#39;</span>]<span class="op">,</span></span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>        Event<span class="op">:</span> {</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>          properties<span class="op">:</span> {</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>            id<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a>            title<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>            description<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>            groupId<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>            createdBy<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>            startDate<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>            endDate<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>            location<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>            status<span class="op">:</span> {</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>              enum<span class="op">:</span> [<span class="st">&#39;planning&#39;</span><span class="op">,</span> <span class="st">&#39;voting&#39;</span><span class="op">,</span> <span class="st">&#39;confirmed&#39;</span><span class="op">,</span> <span class="st">&#39;in_progress&#39;</span><span class="op">,</span> <span class="st">&#39;completed&#39;</span><span class="op">,</span> <span class="st">&#39;cancelled&#39;</span>]<span class="op">,</span></span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a>            attendees<span class="op">:</span> {</span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;array&#39;</span><span class="op">,</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>              items<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>            aiGenerated<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;boolean&#39;</span> }<span class="op">,</span></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>            createdAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>            updatedAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>          required<span class="op">:</span> [<span class="st">&#39;id&#39;</span><span class="op">,</span> <span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;groupId&#39;</span><span class="op">,</span> <span class="st">&#39;createdBy&#39;</span><span class="op">,</span> <span class="st">&#39;startDate&#39;</span>]<span class="op">,</span></span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>        Expense<span class="op">:</span> {</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>          properties<span class="op">:</span> {</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>            id<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a>            title<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>            description<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>            amount<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;number&#39;</span> }<span class="op">,</span></span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>            currency<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> enum<span class="op">:</span> [<span class="st">&#39;EUR&#39;</span><span class="op">,</span> <span class="st">&#39;USD&#39;</span><span class="op">,</span> <span class="st">&#39;GBP&#39;</span>] }<span class="op">,</span></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>            category<span class="op">:</span> {</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>              enum<span class="op">:</span> [<span class="st">&#39;accommodation&#39;</span><span class="op">,</span> <span class="st">&#39;transport&#39;</span><span class="op">,</span> <span class="st">&#39;food&#39;</span><span class="op">,</span> <span class="st">&#39;entertainment&#39;</span><span class="op">,</span> <span class="st">&#39;other&#39;</span>]<span class="op">,</span></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a>            groupId<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>            eventId<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>            paidBy<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>            participants<span class="op">:</span> {</span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;array&#39;</span><span class="op">,</span></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>              items<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;uuid&#39;</span> }<span class="op">,</span></span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>            status<span class="op">:</span> {</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>              enum<span class="op">:</span> [<span class="st">&#39;pending&#39;</span><span class="op">,</span> <span class="st">&#39;paid&#39;</span><span class="op">,</span> <span class="st">&#39;settled&#39;</span><span class="op">,</span> <span class="st">&#39;cancelled&#39;</span>]<span class="op">,</span></span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>            date<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date&#39;</span> }<span class="op">,</span></span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>            createdAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>            updatedAt<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span><span class="op">,</span> format<span class="op">:</span> <span class="st">&#39;date-time&#39;</span> }<span class="op">,</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>          required<span class="op">:</span> [<span class="st">&#39;id&#39;</span><span class="op">,</span> <span class="st">&#39;title&#39;</span><span class="op">,</span> <span class="st">&#39;amount&#39;</span><span class="op">,</span> <span class="st">&#39;category&#39;</span><span class="op">,</span> <span class="st">&#39;paidBy&#39;</span>]<span class="op">,</span></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>        Error<span class="op">:</span> {</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a>          type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>          properties<span class="op">:</span> {</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>            success<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;boolean&#39;</span><span class="op">,</span> example<span class="op">:</span> <span class="kw">false</span> }<span class="op">,</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>            error<span class="op">:</span> {</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a>              type<span class="op">:</span> <span class="st">&#39;object&#39;</span><span class="op">,</span></span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>              properties<span class="op">:</span> {</span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>                code<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>                message<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;string&#39;</span> }<span class="op">,</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a>                details<span class="op">:</span> { type<span class="op">:</span> <span class="st">&#39;object&#39;</span> }<span class="op">,</span></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>    security<span class="op">:</span> [</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a>        bearerAuth<span class="op">:</span> []<span class="op">,</span></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>  apis<span class="op">:</span> [<span class="st">&#39;./src/routes/*.ts&#39;</span><span class="op">,</span> <span class="st">&#39;./src/models/*.ts&#39;</span>]<span class="op">,</span></span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a><span class="im">export</span> <span class="kw">const</span> specs <span class="op">=</span> <span class="fu">swaggerJsdoc</span>(options)<span class="op">;</span></span></code></pre></div>
<hr />
<p><em>[Suite dans la partie suivante…]</em></p>
</body>
</html>
